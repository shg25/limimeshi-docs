# Feature Specification: 管理画面（Admin Panel）

**Feature Branch**: `001-admin-panel`  
**Created**: 2025-11-10  
**Status**: Draft  
**Input**: User description: "React Adminを使用した管理画面。チェーン店、メニュー、タグの手動登録・編集・削除機能を提供。管理者認証（メール+パスワード、Custom Claims）必須。手動データ登録の基盤となる最優先機能。Phase2 MVPで実装。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - チェーン店の管理 (Priority: P1)

管理者が新しいチェーン店をシステムに登録し、既存のチェーン店情報を更新・削除できる。チェーン店は全ての期間限定メニューの親エンティティであり、これがなければメニュー登録ができないため最優先。

**Why this priority**: チェーン店はメニューの親エンティティであり、メニュー登録の前提条件。これがなければサービス全体が機能しない。

**Independent Test**: チェーン店の登録・一覧表示・編集・削除が完全に動作すれば、この機能は独立して価値を提供できる。

**Acceptance Scenarios**:

1. **Given** 管理者がログイン済み, **When** 新しいチェーン店（名前、タグ、公式URL、ロゴURL）を入力して保存, **Then** チェーン店が一覧に表示され、システムに永続化される
2. **Given** チェーン店が1件以上登録済み, **When** 管理者がチェーン店一覧を表示, **Then** 全てのチェーン店が名前順で表示される
3. **Given** チェーン店が登録済み, **When** 管理者がチェーン店情報を編集して保存, **Then** 変更が即座に反映される
4. **Given** チェーン店が登録済み, **When** 管理者がチェーン店を削除（確認ダイアログ経由）, **Then** チェーン店が一覧から削除される
5. **Given** チェーン店が登録済み, **When** 管理者がチェーン名で検索, **Then** 該当するチェーン店のみが表示される
6. **Given** チェーン店登録フォーム, **When** 管理者がチェーン名を未入力で保存, **Then** エラーメッセージが表示され保存できない

---

### User Story 2 - メニューの管理 (Priority: P1)

管理者が期間限定メニューを手動で登録し、販売期間やステータスを更新できる。これがサービスの核心的価値であり、チェーン店と並んで最優先。

**Why this priority**: 期間限定メニューの情報提供がサービスの主要価値。これがなければユーザーに提供する情報がない。

**Independent Test**: メニューの登録・一覧表示・編集・削除が完全に動作し、チェーン店との紐付けが正しく機能すれば、独立して価値を提供できる。

**Acceptance Scenarios**:

1. **Given** 管理者がログイン済みでチェーン店が1件以上登録済み, **When** 新しいメニュー（所属チェーン、メニュー名、説明、価格、販売期間、ステータス）を入力して保存, **Then** メニューが一覧に表示され、システムに永続化される
2. **Given** メニューが1件以上登録済み, **When** 管理者がメニュー一覧を表示, **Then** 全てのメニューがチェーン名とメニュー名で表示される
3. **Given** メニューが登録済み, **When** 管理者がメニュー情報を編集（販売期間延長、ステータス変更など）して保存, **Then** 変更が即座に一般向けアプリに反映される
4. **Given** メニューが登録済み, **When** 管理者がメニューを削除（確認ダイアログ経由）, **Then** メニューが一覧から削除される
5. **Given** メニューが複数登録済み, **When** 管理者がメニュー名またはチェーン名で検索, **Then** 該当するメニューのみが表示される
6. **Given** メニュー登録フォーム, **When** 管理者がメニュー名または所属チェーンを未選択で保存, **Then** エラーメッセージが表示され保存できない
7. **Given** メニュー登録フォーム, **When** 管理者が販売終了日を「未定」として保存, **Then** メニューは終了日なしで保存される

---

### User Story 3 - タグの管理 (Priority: P2)

管理者がチェーン店を分類するためのタグを登録・編集・削除できる。タグはチェーン店のフィルタリングに使用される補助的機能。

**Why this priority**: タグはチェーン店のフィルタリングとカテゴリ分類を改善するが、なくてもサービスは機能する。

**Independent Test**: タグの登録・一覧表示・編集・削除が完全に動作し、チェーン店登録時にタグ選択ができれば、独立して価値を提供できる。

**Acceptance Scenarios**:

1. **Given** 管理者がログイン済み, **When** 新しいタグ（タグ名、表示順）を入力して保存, **Then** タグが一覧に表示され、チェーン店登録時に選択可能になる
2. **Given** タグが1件以上登録済み, **When** 管理者がタグ一覧を表示, **Then** 全てのタグが表示順で表示される
3. **Given** タグが登録済み, **When** 管理者がタグ名または表示順を編集して保存, **Then** 変更が即座に反映される
4. **Given** タグが登録済み, **When** 管理者がタグを削除（確認ダイアログ経由）, **Then** タグが一覧から削除される
5. **Given** タグ登録フォーム, **When** 管理者がタグ名を未入力で保存, **Then** エラーメッセージが表示され保存できない

---

### User Story 4 - 管理者認証 (Priority: P1)

管理者のみがシステムにアクセスでき、一般ユーザーは管理画面にアクセスできない。全ての管理機能のセキュリティ基盤。

**Why this priority**: セキュリティは非交渉原則。管理者認証なしでは不正なデータ登録・改ざんのリスクがある。

**Independent Test**: 管理者でログインできること、一般ユーザーがアクセスできないこと、ログアウトが機能することを確認できれば、独立して価値を提供できる。

**Acceptance Scenarios**:

1. **Given** 管理者アカウントが登録済み, **When** 管理者がメールアドレスとパスワードでログイン, **Then** 管理画面のダッシュボードが表示される
2. **Given** 一般ユーザーまたは未認証ユーザー, **When** 管理画面のURLにアクセス, **Then** アクセスが拒否される（ログイン画面にリダイレクト）
3. **Given** 管理者がログイン済み, **When** 管理者がログアウトボタンをクリック, **Then** ログアウトされ、ログイン画面に戻る
4. **Given** 管理者ログインフォーム, **When** 誤ったパスワードでログイン試行, **Then** エラーメッセージが表示され、ログインできない

---

### User Story 5 - 入力補助機能 (Priority: P3)

管理者がメニュー登録時に、過去の類似メニューから入力候補を表示し、コピペしやすいフォーム設計で作業効率を向上させる。

**Why this priority**: 運用効率の改善だが、なくても手動入力は可能。Phase2 MVP後の改善として検討可能。

**Independent Test**: チェーン店選択時に過去のメニューが表示されること、類似メニュー名の入力候補が表示されることを確認できれば、独立して価値を提供できる。

**Acceptance Scenarios**:

1. **Given** 管理者がメニュー登録フォームでチェーン店を選択, **When** そのチェーンの過去のメニューが存在, **Then** 過去のメニュー一覧が参考として表示される
2. **Given** 管理者がメニュー名を入力中, **When** 類似するメニュー名が存在, **Then** 入力候補が表示される
3. **Given** 管理者がURL入力フィールドにURLを貼り付け, **When** URLが有効, **Then** ブラウザで開くボタンが表示される

---

### Edge Cases

- チェーン店を削除したとき、紐付くメニューはどうなるか？（削除を防ぐ or カスケード削除）
- 同じチェーン店に同じメニュー名が複数登録されたとき、どう区別するか？
- 販売期間が過去の日付に設定されたとき、警告を表示するか？
- タグを削除したとき、そのタグが紐付いているチェーン店はどうなるか？（タグIDを削除 or 削除を防ぐ）
- ネットワークエラーで保存が失敗したとき、どうユーザーに通知するか？
- 管理者が同時に同じメニューを編集したとき、どちらの変更が優先されるか？

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムは管理者がメールアドレスとパスワードでログインできなければならない
- **FR-002**: システムは管理者のみがチェーン店、メニュー、タグの登録・編集・削除を実行できなければならない
- **FR-003**: システムは一般ユーザーまたは未認証ユーザーの管理画面アクセスを拒否しなければならない
- **FR-004**: システムはチェーン店の新規登録・編集・削除機能を提供しなければならない
- **FR-005**: システムはメニューの新規登録・編集・削除機能を提供しなければならない
- **FR-006**: システムはタグの新規登録・編集・削除機能を提供しなければならない
- **FR-007**: システムはチェーン店一覧、メニュー一覧、タグ一覧を表示しなければならない
- **FR-008**: システムはチェーン名でチェーン店を検索できなければならない
- **FR-009**: システムはメニュー名またはチェーン名でメニューを検索できなければならない
- **FR-010**: システムはチェーン店登録時に複数のタグを選択できなければならない
- **FR-011**: システムはメニューの販売終了日を「未定」として保存できなければならない
- **FR-012**: システムは削除操作時に確認ダイアログを表示しなければならない
- **FR-013**: システムは必須項目が未入力の場合、保存を拒否しなければならない
- **FR-014**: システムは保存・削除エラー時に適切なエラーメッセージを表示しなければならない
- **FR-015**: システムはメニュー登録・編集時にステータス（販売中/販売終了/予定）を選択できなければならない

### Key Entities

- **Chain（チェーン店）**: 大手チェーン店の情報を表す。チェーン名、タグID配列、公式サイトURL、ロゴ画像URLを持つ。メニューの親エンティティ。
- **Menu（メニュー）**: 期間限定メニューの情報を表す。メニュー名、所属チェーンID、説明、価格、画像URL、販売期間、ステータスを持つ。必ずチェーン店に紐付く。
- **Tag（タグ）**: チェーン店をカテゴリ分類するためのタグ。タグ名、表示順を持つ。複数のチェーン店に紐付けられる。
- **Admin（管理者）**: システム管理者の情報を表す。管理者ID、表示名、メールアドレス、認証方法を持つ。管理者権限を持つユーザー。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: 管理者が新しいチェーン店を1分以内に登録できる
- **SC-002**: 管理者が新しいメニューを2分以内に登録できる
- **SC-003**: 管理画面のページ読み込み時間が3秒以内である
- **SC-004**: 保存・削除操作が1秒以内に完了する
- **SC-005**: 一般ユーザーが管理画面にアクセスを試みたとき、100%の確率でアクセスが拒否される
- **SC-006**: 管理者が誤ってデータを削除しようとしたとき、100%の確率で確認ダイアログが表示される
- **SC-007**: 必須項目が未入力の場合、100%の確率で保存が拒否され、明確なエラーメッセージが表示される
- **SC-008**: メニューの変更が保存後、即座に一般向けアプリに反映される（5秒以内）

## Assumptions *(optional)*

- 管理者は1名から開始し、Phase3以降で複数名に拡大する想定
- チェーン店は16店舗から開始し、Phase3以降で追加される可能性がある
- メニューは各チェーン店あたり平均10件程度を想定
- タグは10-20種類程度を想定（「ハンバーガー」「カフェ」「丼」など）
- 管理画面の利用はPC（デスクトップ）を主とし、モバイル最適化は優先度が低い
- 画像は当面テンプレートアイコンを使用し、Phase3以降でチェーン店との提携後に公式画像に切り替える

## Out of Scope *(optional)*

以下はPhase2 MVPの対象外：

- ユーザー管理（一般ユーザーの一覧表示、削除、統計情報）
- レビュー管理（一覧表示、削除、モデレーション）
- 販売終了メニューの一括更新機能
- メニュー登録の効率化（公式サイトのURLを入力すると情報を抽出する機能）
- ダッシュボード（KPI、アクセス解析、コスト監視）
- 2要素認証（Phase2リリース後に追加検討）
- モバイル最適化
