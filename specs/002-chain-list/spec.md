# Feature Specification: チェーン店一覧（Chain List）

**Feature Branch**: `002-chain-list`  
**Created**: 2025-11-14  
**Updated**: 2025-11-28  
**Status**: Draft  
**Input**: User description: "一般ユーザー向けのチェーン店一覧画面（Androidアプリ）。チェーン店を一覧表示し、各チェーン店に紐づくキャンペーンをチェーン店単位で確認できる。ログインユーザーはお気に入り登録したチェーン店のみ表示するフィルタを利用可能。各キャンペーンにはキャンペーン名、販売開始日時、販売終了日時（未設定時は非表示）、ステータス（予定/開始から◯日経過/終了）、説明を表示。X Post URLがあれば埋め込み表示（商品画像代わり）。チェーン店のソート順はユーザーが選択可能（新着順/ふりがな順）。デフォルトは新着順（最新キャンペーンがあるチェーンが上）。キャンペーンは販売開始日時の降順（新しい順）でソート。1年経過したキャンペーンは非表示。ログインユーザーのフィルタ選択・ソート選択は次回訪問時も保持。Phase2 MVPで実装。管理画面で登録されたデータを表示する読み取り専用機能。"

## User Scenarios & Testing *(mandatory)*

### User Story 1 - チェーン店一覧の閲覧 (Priority: P1)

一般ユーザーがチェーン店を一覧表示し、各チェーン店に紐づくキャンペーン情報をチェーン店単位で確認できる。これがサービスの中心的価値であり、ユーザーが最も頻繁に利用する機能。

**Why this priority**: チェーン店とキャンペーン情報の提供がサービスの主要価値。これがなければユーザーに提供する価値がない。

**Independent Test**: チェーン店の一覧表示が正しく動作し、デフォルトで新着順にソートされ、各チェーン店に紐づくキャンペーンが表示されれば、独立して価値を提供できる。

**Acceptance Scenarios**:

1. **Given** 管理画面でチェーン店が複数登録済み, **When** ユーザーがチェーン店一覧画面を開く, **Then** チェーン店が新着順（最新キャンペーンがあるチェーンが上）で表示される
   - 1a. **Given** チェーン店一覧が新着順で表示されている, **When** ユーザーがソート順を「ふりがな順」に変更, **Then** チェーン店がふりがな順（あいうえお順）で表示される
   - 1b. **Given** チェーン店一覧がふりがな順で表示されている, **When** ユーザーがソート順を「新着順」に変更, **Then** チェーン店が新着順で表示される
   - 1c. **Given** ユーザーがソート順を変更, **When** 次回アプリを起動, **Then** 前回のソート設定が保持されている
2. **Given** チェーン店一覧が表示されている, **When** ユーザーが各チェーン店を確認, **Then** チェーン店名、お気に入り登録数、紐づくキャンペーン一覧が表示される
3. **Given** チェーン店にキャンペーンが紐づいている, **When** ユーザーがそのチェーン店を確認, **Then** キャンペーンが販売開始日時の降順（新しい順）で表示される
4. **Given** チェーン店に紐づくキャンペーンが表示されている, **When** ユーザーが各キャンペーンを確認, **Then** キャンペーン名、販売開始日時、ステータス（自動判定）、説明が表示される
5. **Given** キャンペーンに販売終了日時が設定されている, **When** ユーザーがそのキャンペーンを確認, **Then** 販売終了日時が表示される
6. **Given** キャンペーンに販売終了日時が未設定, **When** ユーザーがそのキャンペーンを確認, **Then** 販売終了日時フィールドは表示されない
7. **Given** キャンペーンにX Post URLが登録されている, **When** ユーザーがそのキャンペーンを確認, **Then** X Postが埋め込み表示される（商品画像を含む）
8. **Given** キャンペーンにX Post URLが登録されていない, **When** ユーザーがそのキャンペーンを確認, **Then** X Post埋め込みは表示されない
9. **Given** 販売開始日時から1年以上経過したキャンペーンが存在, **When** ユーザーがチェーン店一覧画面を開く, **Then** そのキャンペーンは表示されない
10. **Given** チェーン店に紐づくキャンペーンが0件, **When** ユーザーがそのチェーン店を確認, **Then** 「現在キャンペーンはありません」と表示される
11. **Given** 管理画面でチェーン店が0件, **When** ユーザーがチェーン店一覧画面を開く, **Then** 「データなし」と表示される

---

### User Story 2 - お気に入りチェーン店フィルタ (Priority: P1)

ログインユーザーがお気に入り登録したチェーン店のみを表示し、関心の高いチェーンの新キャンペーンを素早く確認できる。フィルタ選択は次回訪問時も保持される。

**Why this priority**: お気に入り機能（003）に依存するが、頻繁に使われる重要な機能。ユーザーは同じチェーンを繰り返し確認する傾向があるため、フィルタ選択の永続化と合わせて体験価値が高い。

**Independent Test**: お気に入りフィルタが正しく動作し、お気に入り登録済みチェーン店のみが表示され、フィルタ選択が次回訪問時も保持されれば、独立して価値を提供できる。

**Acceptance Scenarios**:

1. **Given** ログインユーザーがお気に入りチェーン店を1件以上登録済み, **When** ユーザーが「お気に入りのみ表示」フィルタをON, **Then** お気に入り登録したチェーン店のみが表示される
2. **Given** お気に入りフィルタがON, **When** ユーザーがフィルタをOFF, **Then** 全てのチェーン店が再び表示される
3. **Given** ログインユーザーがお気に入りチェーン店を0件登録, **When** ユーザーが「お気に入りのみ表示」フィルタをON, **Then** 「お気に入り登録したチェーン店がありません」と表示される
4. **Given** ログインユーザーがお気に入りフィルタをONに設定, **When** ユーザーが次回アプリを起動, **Then** 前回のフィルタ設定（お気に入りON）が保持されている
5. **Given** 未ログインユーザー, **When** チェーン店一覧画面を表示, **Then** お気に入りフィルタは非表示または無効化されている

---

### Edge Cases

- **チェーン店0件**: 管理画面でチェーン店が1件も登録されていない場合、「データなし」と表示する
- **キャンペーン0件**: チェーン店に紐づくキャンペーンが0件の場合、「現在キャンペーンはありません」と表示する
- **お気に入り0件**: お気に入りチェーン店が0件の場合、「お気に入り登録したチェーン店がありません」と表示する
- **X Post URL未設定**: X Post URLが登録されていない場合、X Post埋め込み非表示
- **X Postに画像がない場合**: X Postに画像が添付されていない場合でも、Postテキストのみ埋め込み表示される
- **X Post削除リスク**: Post作成者がPostを削除した場合、埋め込み表示ができなくなる（外部依存の制約として受け入れる）
- **販売終了日時未設定**: 販売終了日時が未設定の場合、販売終了日時フィールドは非表示。ステータスは「予定」または「開始から◯日経過」「開始から◯ヶ月以上経過」として自動判定される
- **大量チェーン店**: Phase2では16店舗固定のため問題なし。Phase3以降で店舗数が増えた場合は検索・フィルタ機能を検討

## Requirements *(mandatory)*

### Functional Requirements

- **FR-001**: システムはチェーン店を選択されたソート順で一覧表示しなければならない（デフォルト: 新着順）
- **FR-001a**: 新着順: 最新キャンペーンの販売開始日時が新しいチェーン店を上に表示
- **FR-001b**: ふりがな順: チェーン店をふりがな（あいうえお順）で表示
- **FR-001c**: システムはユーザーがソート順を切り替えるUIを提供しなければならない
- **FR-002**: システムは各チェーン店にチェーン店名、お気に入り登録数を表示しなければならない
- **FR-003**: システムは各チェーン店に紐づくキャンペーンを販売開始日時の降順（新しい順）で表示しなければならない
- **FR-004**: システムは販売開始日時から1年以内のキャンペーンのみを表示しなければならない
- **FR-005**: システムは各キャンペーンにキャンペーン名、販売開始日時、ステータス（自動判定）、説明を表示しなければならない
- **FR-006**: システムはキャンペーンに販売終了日時が設定されている場合のみ、販売終了日時を表示しなければならない
- **FR-007**: システムはキャンペーンにX Post URLが登録されている場合、X Postを埋め込み表示しなければならない
- **FR-008**: システムはキャンペーンにX Post URLが登録されていない場合、X Post埋め込みを表示してはならない
- **FR-009**: システムはお気に入りチェーン店フィルタを提供し、ログインユーザーがお気に入り登録済みチェーン店のみを表示できなければならない
- **FR-010**: システムはユーザーのフィルタ選択（全て表示/お気に入りのみ表示）とソート選択（新着順/ふりがな順）を保存し、次回起動時も保持しなければならない
- **FR-011**: システムはチェーン店が0件の場合、「データなし」と表示しなければならない
- **FR-012**: システムはチェーン店に紐づくキャンペーンが0件の場合、「現在キャンペーンはありません」と表示しなければならない
- **FR-013**: システムはお気に入りフィルタ適用時にチェーン店が0件の場合、「お気に入り登録したチェーン店がありません」と表示しなければならない
- **FR-014**: システムは販売開始日時から1年以上経過したキャンペーンを表示してはならない
- **FR-015**: システムはキャンペーンのステータスを販売開始日時と販売終了日時から自動判定しなければならない（予定/開始から◯日経過/開始から◯ヶ月以上経過/終了）

### Key Entities

- **Chain（チェーン店）**: チェーン店情報を表す。メイン画面に一覧表示される。チェーン店名、ふりがな、お気に入り登録数を持つ。
- **Campaign（キャンペーン）**: チェーン店に紐づくキャンペーン情報を表す。キャンペーン名、販売開始日時、販売終了日時、ステータス（自動判定）、説明、X Post URLを持つ。

## Success Criteria *(mandatory)*

### Measurable Outcomes

- **SC-001**: チェーン店一覧の画面表示が3秒以内である（モバイル4G環境、X Post埋め込み部分を除く）
- **SC-002**: ユーザーが興味のあるチェーン店のキャンペーンを10秒以内に見つけられる
- **SC-003**: お気に入りフィルタの操作が1秒以内に完了する
- **SC-004**: チェーン店が0件の場合、適切なメッセージが即座に表示される
- **SC-005**: フィルタ選択・ソート選択が次回起動時に正しく保持されている（100%の確率）
- **SC-006**: ソート順の切り替え操作が1秒以内に完了する

## Assumptions *(optional)*

- チェーン店とキャンペーンデータは管理画面で事前に登録されている
- お気に入り機能（003）は別機能として実装予定
- Phase2ではチェーン店は16店舗固定を想定
- キャンペーン数は各チェーン店あたり平均1〜5件程度を想定
- X Post埋め込み表示はPhase2で実装（商品画像代わりの重要機能）
- X Postの読み込みはアプリ本体の読み込みと分離され、パフォーマンス測定対象外
- Phase2ではお気に入りフィルタの利用にログインが必須
- 販売終了日時が未設定の場合、販売終了日時フィールドは非表示とする
- 販売開始日時から1年以上経過したキャンペーンは自動的に非表示になる（データは削除されない）
- Phase2ではAndroidアプリを優先（Webアプリ対応はPhase3以降）

## Out of Scope *(optional)*

以下はPhase2 MVPの対象外：

### フロントエンド機能（Phase3以降）

- **チェーン店検索機能**: チェーン店名での検索。Phase2では16店舗のみのため、ふりがな順ソートで十分。
- **ページネーション**: チェーン店数が増えた場合に検討。Phase2では16店舗固定のため不要。
- **画像表示**: キャンペーン画像の直接表示機能（公式画像はチェーン店との提携後に検討、Phase2ではX Post埋め込み経由で画像表示）
- **追加ソート機能**: 新着順・ふりがな順以外のソート（人気順など）
- **キャンペーン詳細ページ**: キャンペーンの詳細情報を別画面で表示する機能
- **チェーン店詳細ページ**: 各チェーンの過去キャンペーン、店舗情報などを表示する機能
- **Webアプリ**: Phase3以降で実装予定（Phase2はAndroidアプリ優先）

### その他の機能

- **レビュー表示**: キャンペーンに対するユーザーレビューの表示（Phase3で実装予定）
- **位置情報連携**: 近くのチェーン店のキャンペーンを表示する機能
- **通知機能**: 新しいキャンペーンが追加されたときの通知
- **比較機能**: 複数のキャンペーンを並べて比較する機能
