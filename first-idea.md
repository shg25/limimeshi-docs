## 作成者

重次弘規（[@shg25](https://github.com/shg25)）

**作成日**：2025/10/13
**最終更新**：2025/10/14

---

# このドキュメントについて

- 新規サービスの企画書、設計書
- GitHubの公開リポジトリとして公開
- ドキュメントは基本的にAIエージェントが読み取りやすいMarkdown形式で作成
- 複数のフレームワークを組み合わせて作成
  - リーンキャンバス、インセプションデッキ、GitHub Spec Kit

---

# サービス名・プロジェクト名

## 正式名称
**期間限定めし**

## 略称
**リミメシ**

## 英語表記
Limited Meshi（Limimeshi）

## プロジェクト名
`limimeshi`

## ドメイン候補
- `limimeshi.com`（推奨）
- `limitmeshi.com`
- `limitedmeshi.com`

## SNS
- ハッシュタグ：`#リミメシ`
- アカウント：`@limimeshi`

## サービスコンセプト
「なじみのチェーン店で新しい体験を楽しむ」

期間限定メニューに特化した情報プラットフォーム。チェーン店の「今だけ」を一覧で確認できるサービス。

---

# ターゲットユーザー・ペルソナ

## サービスのコアバリュー

「評価の高い店を探すより、なじみのチェーン店で新しい体験を楽しむ」

チェーン店には、以下のような**隠れた価値**があります
- 入りやすく、居心地が良い
- 価格が明確で、失敗が少ない
- 期間限定メニューで「新鮮さ」も得られる

このサービスは、**チェーン店の期間限定メニューに特化**することで、上記の価値を最大化します。

---

## メインターゲット

- 年齢層
  - 20代〜50代（特に30代〜50代）
- 価値観
  - 節約志向だが、単なる安さではなく「コスパの良い満足感」を求める
- 行動特性
  - 外食は週1〜3回程度
  - 食べログやRettyで高評価店を見ることもあるが、結局チェーン店に落ち着く
  - 「いつもの店」があるが、たまには変化も欲しい
- よく使うサービス
  - 食べログ、Retty、各チェーン公式アプリ、Google Maps

---

## ペルソナ1：堅実派の会社員（45歳男性）

### 名前
芹沢辰哉

### プロフィール
- 年齢・職業
  - 45歳、会社員（中間管理職）
- 家族構成
  - 既婚、子供あり
- 外食頻度
  - 平日ランチ週3回、休日に家族で月1〜2回

### 課題
- 節約はしたいが、毎回同じメニューでは飽きる
- 食べログで高評価店を試したこともあるが、「期待値を超える感動」は少ない
- チェーン店の安定感と、たまの「新しさ」を両立したい

### 利用シーン
- 平日ランチで「今日は何を食べようか」と迷ったとき
- 休日に家族で外食する際、「期間限定メニューがあるなら行ってみるか」と選択肢に加える

### 期待する価値
- チェーン店の期間限定メニューが一覧できる
- 「いつもの店」で新しい体験ができる安心感
- 食べた記録を残して、「去年も食べたな」と振り返れる

### このサービスを使う理由
- 食べログは「新しい店」を探すのに使うが、このサービスは「なじみの店の新メニュー」を探すのに使う

---

## ペルソナ2：情報感度の高い中高生（16歳女子）

### 名前
汐美ゆとり

### プロフィール
- 年齢
  - 16歳、高校2年生
- お小遣い
  - 月5,000円程度
- 外食頻度
  - 友達と週1回（放課後や休日）

### 課題
- お小遣いの範囲で、話題性のあるメニューを楽しみたい
- SNSで話題のメニューを見逃したくない
- 友達との会話のネタになる「期間限定」が好き

### 利用シーン
- 友達と放課後にカフェやファーストフードに行く前
- 「今どこのチェーン店で何が出てるか」を調べる
- 食べた後にレビューを投稿して、友達にシェア

### 期待する価値
- 話題性のある期間限定メニューを見逃さない
- 友達より先に情報をキャッチして、提案できる
- 食べた記録を残して、「これ3回も食べたんだ！」と振り返れる

### このサービスを使う理由
- 各チェーンの公式サイトをいちいち見るのは面倒
- このサービスなら、一覧でパッと見られる

---

## ペルソナ3：時間を有効活用したい営業マン（32歳男性）

### 名前
藤本洸平

### プロフィール
- 年齢・職業
  - 32歳、営業職
- 仕事の特徴
  - 外回りが多く、訪問先の近辺で食事や時間潰しをすることが多い
- 外食頻度
  - 平日ランチ毎日、カフェで時間潰し週2〜3回

### 課題
- 訪問先の近くで「どこで時間を潰すか」を素早く決めたい
- いつも同じ店だと飽きるが、新しい店を探す時間はない
- 期間限定メニューがあるなら、それを選びたい

### 利用シーン
- アポとアポの合間に「近くのチェーン店で何か食べよう」と考えたとき
- 位置情報をもとに、近くのチェーン店の期間限定メニューを確認
- カフェで時間潰しをする際、「今スタバで何が出てるか」を確認

### 期待する価値
- 位置情報から、近くのチェーン店を素早く見つけられる
- 期間限定メニューの有無で、「今日はここに行こう」と決められる
- 通常メニューも確認できるので、期間限定が好みでなければ通常メニューも選べる

### このサービスを使う理由
- Google Mapsでは「期間限定メニュー」までは分からない
- このサービスなら、チェーン店の「今」が一目で分かる

---

## ペルソナ4：気分転換を求めるOL（28歳女性）

### 名前
佐倉翔子

### プロフィール
- 年齢・職業
  - 28歳、事務職
- 生活スタイル
  - 通勤時や昼休み、帰宅時にカフェを利用することが多い
- 外食頻度
  - カフェ週3〜4回、ランチ週2〜3回

### 課題
- 仕事の合間の息抜きに、「いつもと違う何か」を楽しみたい
- カフェの新メニューは好きだが、いちいち公式サイトを見るのは面倒
- 期間限定メニューを見逃すと、「あれ食べたかったのに」と後悔する

### 利用シーン
- 通勤前に「今日はカフェで何を買おう」と考えたとき
- 昼休みに「今日はどこでランチしよう」と迷ったとき
- 帰宅時に「今日は疲れたから、カフェで一息つこう」と思ったとき

### 期待する価値
- お気に入りのチェーン店の期間限定メニューを見逃さない
- 「今日はこれを食べよう」と気分が上がる
- 食べた記録を残して、「去年のこの時期も食べたな」と振り返れる

### このサービスを使う理由
- スタバ、ドトール、コメダなどの公式サイトを個別に見るのは面倒
- このサービスなら、お気に入り登録したチェーンの期間限定メニューが一覧で見られる

---

## 競合サービスとの差別化

| サービス | 強み | 弱み | 本サービスとの違い |
|---------|------|------|------------------|
| **食べログ / Retty** | 口コミが豊富、幅広いジャンル | チェーン店の期間限定メニューに特化していない | 本サービスは「チェーン店の期間限定メニュー」に特化 |
| **各チェーン公式アプリ** | 公式情報、クーポンあり | 複数チェーンを横断して見られない | 本サービスは複数チェーンを横断して一覧できる |
| **Google Maps** | 位置情報と連携、店舗情報が豊富 | 期間限定メニューの情報はない | 本サービスは位置情報 + 期間限定メニューの組み合わせ |
| **SNS（Twitter / Instagram）** | リアルタイムな口コミ | 情報が散在、信頼性にバラつき | 本サービスは公式情報をベースに整理 |

---

## このサービスが解決する課題

1. 情報が散在している
    - 各チェーンの公式サイトを個別に見る必要がある
    - **本サービスなら一覧で確認できる**

2. 期間限定メニューを見逃す
    - いつの間にか終わっていた、という経験がある
    - **本サービスならお気に入り登録で見逃さない**

3. 「今日は何を食べよう」の選択肢が広がらない
    - いつも同じ店、同じメニューになりがち
    - **本サービスなら「いつもの店」で新しい体験ができる**

4. 位置情報と期間限定メニューが連携していない
    - 近くのチェーン店で「今何が出ているか」が分からない
    - **本サービスなら位置情報から近くの期間限定メニューが見られる**

---

# 基本機能

- 日本の大手チェーン店で現在販売中の期間限定メニューを一覧できるサービス
  - 例：マクドナルドの月見バーガーやグラコロ、日高屋のチゲ味噌ラーメン、松屋のうまトマハンバーグ定食、丸亀製麺のトマたまカレーうどん
- チェーン店をお気に入り登録して、自分に関連性のあるチェーン店のみの一覧が作成できる
- チェーン店詳細では期間限定以外の通常メニューも確認できる
- 食べたメニューの記録とレビューができる
  - 複数回食べたことも記録でき、振り返ることができる
    - 例えば、期間限定メニューを5回も繰り返して食べていたら、思い入れがあることが伝わる（点数の評価では表せない）

---

# 追加機能

- 位置情報を元に近くにあるチェーン店の期間限定メニューの確認
  - 例えば、営業先とのアポまでの時間潰しにどこのファーストフード店で時間潰しをするかの判断基準として使える
  - チェーン店詳細から通常メニューも確認できる（期間限定メニュー以外のメニューも知らない可能性も十分にありえる）

---

# データモデル（概要）

## エンティティ一覧

このサービスで管理する主要なデータエンティティ

- Tags（タグ）
- Chains（チェーン店）
- Menus（メニュー）
- Users（ユーザー）
- Admins（管理者）
- Reviews（レビュー）
- Favorites（お気に入り）

---

## Tags（タグ）

### 主要な属性
- タグID
- タグ名（例：「ハンバーガー」「カフェ」「丼」）
- 表示順
- 作成日時

### 備考
- チェーン店のカテゴリ分類に使用
- 管理画面でタグの追加・編集・削除が可能
- タグ名の統一により、検索やフィルタリングの精度向上

---

## Chains（チェーン店）

### 主要な属性
- チェーンID
- チェーン名
- タグID（配列、複数タグ対応）
- 公式サイトURL
- ロゴ画像URL
- 作成日時
- 更新日時

### 備考
- 初期リリースでは16チェーンを手動登録
- タグは複数設定可能（例：スタバ→「カフェ」「テイクアウト」「モーニング」）
- 管理画面から追加・編集可能

---

## Menus（メニュー）

### 主要な属性
- メニューID
- 所属チェーンID（外部キー）
- メニュー名（必須）
- 説明（任意）
- 価格（任意）
- 画像URL（任意）
- 画像タイプ（テンプレート / 公式）
- メニュータイプ（期間限定 / 通常）
- 販売期間（任意）
  - 開始日（任意）
  - 終了日（任意、未定の場合はnull）
- ステータス（販売中 / 販売終了 / 予定）
- 作成日時
- 更新日時

### 備考
- メニュー名以外は任意入力
- 「期間限定」の定義は管理者の判断
- 販売期間の終了日は未定がほとんど（手動更新）
- 画像は当面テンプレアイコンを使用
  - 月見系、グラコロ系、カレー系などカテゴリ別アイコン
  - 将来的にチェーン店と提携したら公式画像に切り替え
- 注意書き：「販売終了している可能性があります。店舗にご確認ください」

### 将来的な改善案
- ユーザーからの「販売終了報告」機能
- 管理画面で販売終了を一括更新

---

## Users（ユーザー）

### 主要な属性
- ユーザーID（Firebase UID）
- 表示名（任意）
- メールアドレス（Googleログインの場合）
- プロフィール画像URL（任意）
- 認証方法（匿名 / Google）
- 作成日時
- 最終ログイン日時

### 備考
- 匿名認証から始めて、後でGoogleログインに移行（UID継続）
- Custom Claimsは持たない（一般ユーザー）
- Firestoreは`/users/{uid}`コレクションで管理

---

## Admins（管理者）

### 主要な属性
- 管理者ID（Firebase UID）
- 表示名
- メールアドレス
- 認証方法（メール＋パスワード）
- Custom Claims（`admin: true`）
- 作成日時
- 最終ログイン日時

### 備考
- Firebase Authenticationは共通だが、認証方法は「メール＋パスワード」
- Custom Claimsで`admin: true`を設定
- Firestoreは`/admins/{uid}`コレクションで管理（一般ユーザーと分離）
- Security Rulesで`isAdmin()`関数を使って権限チェック

---

## Reviews（レビュー）

### 主要な属性
- レビューID
- ユーザーID（外部キー）
- メニューID（外部キー）
- 食べた日
- コメント（任意）
- 作成日時
- 更新日時

### 備考
- 点数評価は行わない（複数回食べた記録が重要）
- 同じメニューを同じ日に複数回レビュー可能（熱狂的なファン対応）
- 重複チェックなし（実装がシンプル、柔軟性が高い）

### UI上の工夫
- マイページで「このメニューを5回食べてる！」と視覚的に表示
- 食べた回数でバッジ表示（🍔×5など）

---

## Favorites（お気に入り）

### 主要な属性
- お気に入りID
- ユーザーID（外部キー）
- チェーンID（外部キー）
- 登録日時

### 備考
- ユーザーごとにお気に入りチェーン店を管理
- お気に入り登録したチェーンの期間限定メニューを優先表示

---

## データの関連性

```
Tags (1) ─── (N) Chains ─── (N) Menus
                │              │
Users (1) ─── (N) Favorites    │
  │                            │
  └─── (N) Reviews ─────────── (1)

Admins (管理者、別コレクション)
```

---

## 未解決の問題

- スクレイピングで取得したデータの正規化方法
  - 各チェーン店ごとにHTMLの構造が異なるため、個別対応が必要
  - 別途詳細な設計が必要

---

# スクレイピング・データ更新の方針

## 基本方針

未完成のサービスにスクレイピングの許諾が降りる可能性は低いため、**初期フェーズではスクレイピング禁止、手動登録でスタート**します。

ただし、**差分検知＋通知**は合法的に運用可能と判断し、以下の構成で実装します。

---

## データ取得方法

### 初期フェーズ（MVP）
- **完全手動登録**
  - 管理画面（React Admin）からメニュー情報を手入力
  - チェーン店の公式サイトを人が確認し、期間限定メニュー情報を登録
  - 画像はテンプレアイコンを使用

### 将来フェーズ（チェーン店提携後）
- **半自動化**
  - 提携内容に応じて最適な方法を採用
  - 公式API、データ提供、スクレイピング許可など、提携内容により異なる
  - 画像も公式素材に切り替え

---

## 差分検知システム（合法的運用）

### 目的
各チェーン店の公式サイトの更新を自動検知し、管理者に通知することで、手動登録の負担を軽減する。

### 許される範囲（✅）
- **1日1回のアクセス**
  - 過剰アクセスを避け、サーバー負荷を最小限に
- **robots.txt・利用規約を尊重**
  - 各チェーン店のrobots.txtに従う
  - 利用規約でスクレイピング禁止が明記されている場合は対象外
- **ハッシュ値のみを保存（TTL 30日）**
  - HTMLは保存せず、ハッシュ値のみをFirestoreに保存
  - 差分検知のためのハッシュ値比較用
  - 古いハッシュ値は自動削除
- **差分検知目的でのみ使用**
  - 転載・公開なし
  - Slack通知にはURLと検知時刻のみ記載

### 禁止する範囲（🚫）
- 本文の恒久保存
- 自動転載や全文公開
- 会員限定・有料ページの取得

### 実装イメージ

```
Firebase Cloud Scheduler（1日1回 AM 6:00）
  ↓
Cloud Functions（onSchedule）
  ↓
各チェーン店の公式サイト（新着情報ページなど）にアクセス
  ↓
HTMLのハッシュ値を計算（HTMLは保存しない）
  ↓
Firestore（previous_hashes コレクション）のハッシュ値と比較
  ↓
差分があれば Slack に通知
  「🔔 マクドナルドのサイトが更新されました
   URL: https://...
   検知時刻: 2025-10-13 06:05」
  ↓
管理者が確認して、手動で登録
```

---

## データの正規化

### 課題
各チェーン店ごとにHTMLの構造が異なるため、個別対応が必要。

### 初期フェーズの対応方針
- **パーサーは使用しない**
- 管理者が公式サイトを目視確認し、手動で入力
- 管理画面（React Admin）で以下の項目を入力
  - メニュー名
  - 価格
  - 販売期間（開始日・終了日）
  - 説明文

### 将来フェーズの対応方針
チェーン店と提携後、以下のいずれかの方法を採用：

1. **公式API連携**
   - チェーン店が公式APIを提供する場合

2. **データ提供**
   - チェーン店がCSVやJSONでデータを定期提供する場合

3. **スクレイピング許可**
   - チェーン店から許可を得た場合のみ、パーサーを使用
   - 例：`parsers/mcdonald.ts`、`parsers/starbucks.ts`
   - 共通インターフェースで統一
     ```typescript
     interface MenuDraft {
       chainId: string;
       name: string;
       price?: number;
       saleStartDate?: string;
       saleEndDate?: string;
       description?: string;
     }
     ```

---

## 注意事項

### 法的リスクの回避
- **スクレイピング禁止が明記されているサイトは対象外**
- **著作権を侵害しない**
  - 本文をそのまま転載しない
  - 画像は公式素材を使わず、テンプレアイコンを使用
- **個人情報を取得しない**
- **過剰アクセスをしない**（1日1回程度）

### ユーザーへの注意書き
サービス上に以下の注意書きを表示：
「販売終了している可能性があります。詳細は店舗にご確認ください」

---

## まとめ

| 項目 | 初期フェーズ | 将来フェーズ（チェーン店提携後） |
|------|-------------|------------------------------|
| データ取得 | 完全手動登録 | 半自動化（提携内容に応じて） |
| 差分検知 | 1日1回の自動チェック（ハッシュ値のみ） | 同左 or Webhook（提携後） |
| 画像 | テンプレアイコン | 公式素材 |

**補足**: 提携後の具体的な方法（公式API、データ提供、スクレイピング許可など）は、提携内容により異なるため、現時点では未定。

---

# 技術スタック

- Firebase
  - Auth / Firestore / Functions / Hosting / Scheduler
- Cloud Run
  - 将来的なAPI / BFF用
- Web
  - React
- 管理画面
  - React Admin
- モバイル
  - Expo + React Native / SwiftUI / Jetpack Compose
- CI/CD
  - GitHub Actions

---

# リポジトリ構成

| リポジトリ | 役割 | 備考 |
|-------------|------|------|
| `limimeshi-web` | 一般向けWebアプリ | Hosting:web |
| `limimeshi-admin` | 管理UI | Hosting:admin |
| `limimeshi-jobs` | 定期処理・差分検知 | Functions（onSchedule） |
| `limimeshi-docs` | 企画・設計・ADR・AI前提 | 公開リポジトリ |
| （将来）`limimeshi-api` | 共通API / BFF | Cloud Functions (HTTP) |
| （将来）`limimeshi-expo`, `limimeshi-ios`, `limimeshi-android` | 各モバイル実装 | 学習目的 |

---

# 認証・権限ルール

- フロント
  - 匿名認証 → Googleログイン（UID継続）
- 管理画面
  - メール＋パスワード、`customClaims.admin=true`
- Firestore Security Rules
  - `isAdmin()` / `isOwner()` を共通関数化
  - 一般ユーザーと管理者で明確に分岐
- 危険操作
  - Functions 経由

---

# 対象のチェーン店候補

- ハンバーガー
  - マクドナルド、モスバーガー、ケンタッキーフライドチキン、バーガーキング、ロッテリア、サブウェイ、フレッシュネスバーガー
- 弁当
  - ほっともっと、ほっかほっか亭、キッチンオリジン
- その他のファーストフード
  - 銀だこ
- 丼
  - 吉野家、すき家、松屋、なか卯、かつや、てんや、松のや
- うどん
  - 丸亀製麺、はなまるうどん
- 寿司
  - スシロー、はま寿司、くら寿司、かっぱ寿司
- 洋食
  - カレーハウス CoCo壱番屋、ハンバーグレストラン びっくりドンキー、洋麺屋五右衛門
- 中華
  - 日高屋、餃子の王将、大阪王将、幸楽苑、リンガーハット、福しん、ぎょうざの満洲
- ピザ
  - ドミノピザ、ピザハット、ピザーラ
- 居酒屋
  - 鳥貴族、やきとり大吉、串カツ田中
- カフェ
  - スターバックスコーヒー、ドトールコーヒーショップ、コメダ珈琲店、タリーズコーヒー、星乃珈琲店、サンマルクカフェ

## 初期リリースで対応するチェーン店候補

- マクドナルド
- モスバーガー
- ケンタッキーフライドチキン
- バーガーキング
- 吉野家
- すき家
- 松屋
- なか卯
- かつや
- 丸亀製麺
- カレーハウス CoCo壱番屋
- 日高屋
- 餃子の王将
- スターバックスコーヒー
- コメダ珈琲店
- サンマルクカフェ

---

# 収益モデル

- SSP広告を表示してアクセス数を増やす
- アクセス数が集まってきたら、新メニューの告知広告を出したいというチェーン店が現れるかもしれない

---

# 非機能要件

TBD（今後詳細化）

---

# 開発フェーズ・マイルストーン

TBD（今後詳細化）

---

# リスクと対策

TBD（今後詳細化）

---

# モニタリング・分析

TBD（今後詳細化）

---
