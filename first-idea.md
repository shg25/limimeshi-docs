## 作成者

重次弘規（[@shg25](https://github.com/shg25)）

**作成日**：2025/10/13
**最終更新**：2025/10/14

---

# このドキュメントについて

- 新規サービスの企画書、設計書
- GitHubの公開リポジトリとして公開
- ドキュメントは基本的にAIエージェントが読み取りやすいMarkdown形式で作成
- 複数のフレームワークを組み合わせて作成
  - リーンキャンバス、インセプションデッキ、GitHub Spec Kit

---

# サービス名・プロジェクト名

## 正式名称
**期間限定めし**

## 略称
**リミメシ**

## 英語表記
Limited Meshi（Limimeshi）

## プロジェクト名
`limimeshi`

## ドメイン候補
- `limimeshi.com`（推奨）
- `limitmeshi.com`
- `limitedmeshi.com`

## SNS
- ハッシュタグ：`#リミメシ`
- アカウント：`@limimeshi`

## サービスコンセプト
「なじみのチェーン店で新しい体験を楽しむ」

期間限定メニューに特化した情報プラットフォーム
チェーン店の「今だけ」を一覧で確認できるサービス

---

# ターゲットユーザー・ペルソナ

## サービスのコアバリュー

「評価の高い店を探すより、なじみのチェーン店で新しい体験を楽しむ」

チェーン店には、以下のような**隠れた価値**があります
- 入りやすく、居心地が良い
- 価格が明確で、失敗が少ない
- 期間限定メニューで「新鮮さ」も得られる

このサービスは、**チェーン店の期間限定メニューに特化**することで、上記の価値を最大化する

---

## メインターゲット

- 年齢層
  - 20代〜50代（特に30代〜50代）
- 価値観
  - 節約志向だが、単なる安さではなく「コスパの良い満足感」を求める
- 行動特性
  - 外食は週1〜3回程度
  - 食べログやRettyで高評価店を見ることもあるが、結局チェーン店に落ち着く
  - 「いつもの店」があるが、たまには変化も欲しい
- よく使うサービス
  - 食べログ、Retty、各チェーン公式アプリ、Google Maps

---

## ペルソナ1：堅実派の会社員（45歳男性）

### 名前
芹沢辰哉

### プロフィール
- 年齢・職業
  - 45歳、会社員（中間管理職）
- 家族構成
  - 既婚、子供あり
- 外食頻度
  - 平日ランチ週3回、休日に家族で月1〜2回

### 課題
- 節約はしたいが、毎回同じメニューでは飽きる
- 食べログで高評価店を試したこともあるが、「期待値を超える感動」は少ない
- チェーン店の安定感と、たまの「新しさ」を両立したい

### 利用シーン
- 平日ランチで「今日は何を食べようか」と迷ったとき
- 休日に家族で外食する際、「期間限定メニューがあるなら行ってみるか」と選択肢に加える

### 期待する価値
- チェーン店の期間限定メニューが一覧できる
- 「いつもの店」で新しい体験ができる安心感
- 食べた記録を残して、「去年も食べたな」と振り返れる

### このサービスを使う理由
- 食べログは「新しい店」を探すのに使うが、このサービスは「なじみの店の新メニュー」を探すのに使う

---

## ペルソナ2：情報感度の高い中高生（16歳女子）

### 名前
汐美ゆとり

### プロフィール
- 年齢
  - 16歳、高校2年生
- お小遣い
  - 月5,000円程度
- 外食頻度
  - 友達と週1回（放課後や休日）

### 課題
- お小遣いの範囲で、話題性のあるメニューを楽しみたい
- SNSで話題のメニューを見逃したくない
- 友達との会話のネタになる「期間限定」が好き

### 利用シーン
- 友達と放課後にカフェやファーストフードに行く前
- 「今どこのチェーン店で何が出てるか」を調べる
- 食べた後にレビューを投稿して、友達にシェア

### 期待する価値
- 話題性のある期間限定メニューを見逃さない
- 友達より先に情報をキャッチして、提案できる
- 食べた記録を残して、「これ3回も食べたんだ！」と振り返れる

### このサービスを使う理由
- 各チェーンの公式サイトをいちいち見るのは面倒
- このサービスなら、一覧でパッと見られる

---

## ペルソナ3：時間を有効活用したい営業マン（32歳男性）

### 名前
藤本洸平

### プロフィール
- 年齢・職業
  - 32歳、営業職
- 仕事の特徴
  - 外回りが多く、訪問先の近辺で食事や時間潰しをすることが多い
- 外食頻度
  - 平日ランチ毎日、カフェで時間潰し週2〜3回

### 課題
- 訪問先の近くで「どこで時間を潰すか」を素早く決めたい
- いつも同じ店だと飽きるが、新しい店を探す時間はない
- 期間限定メニューがあるなら、それを選びたい

### 利用シーン
- アポとアポの合間に「近くのチェーン店で何か食べよう」と考えたとき
- 位置情報をもとに、近くのチェーン店の期間限定メニューを確認
- カフェで時間潰しをする際、「今スタバで何が出てるか」を確認

### 期待する価値
- 位置情報から、近くのチェーン店を素早く見つけられる
- 期間限定メニューの有無で、「今日はここに行こう」と決められる
- 通常メニューも確認できるので、期間限定が好みでなければ通常メニューも選べる

### このサービスを使う理由
- Google Mapsでは「期間限定メニュー」までは分からない
- このサービスなら、チェーン店の「今」が一目で分かる

---

## ペルソナ4：気分転換を求めるOL（28歳女性）

### 名前
佐倉翔子

### プロフィール
- 年齢・職業
  - 28歳、事務職
- 生活スタイル
  - 通勤時や昼休み、帰宅時にカフェを利用することが多い
- 外食頻度
  - カフェ週3〜4回、ランチ週2〜3回

### 課題
- 仕事の合間の息抜きに、「いつもと違う何か」を楽しみたい
- カフェの新メニューは好きだが、いちいち公式サイトを見るのは面倒
- 期間限定メニューを見逃すと、「あれ食べたかったのに」と後悔する

### 利用シーン
- 通勤前に「今日はカフェで何を買おう」と考えたとき
- 昼休みに「今日はどこでランチしよう」と迷ったとき
- 帰宅時に「今日は疲れたから、カフェで一息つこう」と思ったとき

### 期待する価値
- お気に入りのチェーン店の期間限定メニューを見逃さない
- 「今日はこれを食べよう」と気分が上がる
- 食べた記録を残して、「去年のこの時期も食べたな」と振り返れる

### このサービスを使う理由
- スタバ、ドトール、コメダなどの公式サイトを個別に見るのは面倒
- このサービスなら、お気に入り登録したチェーンの期間限定メニューが一覧で見られる

---

## 競合サービスとの差別化

| サービス | 強み | 弱み | 本サービスとの違い |
|---------|------|------|------------------|
| **食べログ / Retty** | 口コミが豊富、幅広いジャンル | チェーン店の期間限定メニューに特化していない | 本サービスは「チェーン店の期間限定メニュー」に特化 |
| **各チェーン公式アプリ** | 公式情報、クーポンあり | 複数チェーンを横断して見られない | 本サービスは複数チェーンを横断して一覧できる |
| **Google Maps** | 位置情報と連携、店舗情報が豊富 | 期間限定メニューの情報はない | 本サービスは位置情報 + 期間限定メニューの組み合わせ |
| **SNS（Twitter / Instagram）** | リアルタイムな口コミ | 情報が散在、信頼性にバラつき | 本サービスは公式情報をベースに整理 |

---

## このサービスが解決する課題

1. 情報が散在している
    - 各チェーンの公式サイトを個別に見る必要がある
    - **本サービスなら一覧で確認できる**

2. 期間限定メニューを見逃す
    - いつの間にか終わっていた、という経験がある
    - **本サービスならお気に入り登録で見逃さない**

3. 「今日は何を食べよう」の選択肢が広がらない
    - いつも同じ店、同じメニューになりがち
    - **本サービスなら「いつもの店」で新しい体験ができる**

4. 位置情報と期間限定メニューが連携していない
    - 近くのチェーン店で「今何が出ているか」が分からない
    - **本サービスなら位置情報から近くの期間限定メニューが見られる**

---

# 基本機能

- 日本の大手チェーン店で現在販売中の期間限定メニューを一覧できるサービス
  - 例：マクドナルドの月見バーガーやグラコロ、日高屋のチゲ味噌ラーメン、松屋のうまトマハンバーグ定食、丸亀製麺のトマたまカレーうどん
- チェーン店をお気に入り登録して、自分に関連性のあるチェーン店のみの一覧が作成できる
- チェーン店詳細では期間限定以外の通常メニューも確認できる
- 食べたメニューの記録とレビューができる
  - 複数回食べたことも記録でき、振り返ることができる
    - 例えば、期間限定メニューを5回も繰り返して食べていたら、思い入れがあることが伝わる（点数の評価では表せない）

---

# 追加機能

- 位置情報を元に近くにあるチェーン店の期間限定メニューの確認
  - 例えば、営業先とのアポまでの時間潰しにどこのファーストフード店で時間潰しをするかの判断基準として使える
  - チェーン店詳細から通常メニューも確認できる（期間限定メニュー以外のメニューも知らない可能性も十分にありえる）

---

# データモデル（概要）

## エンティティ一覧

このサービスで管理する主要なデータエンティティ

- Tags（タグ）
- Chains（チェーン店）
- Menus（メニュー）
- Users（ユーザー）
- Admins（管理者）
- Reviews（レビュー）
- Favorites（お気に入り）

---

## Tags（タグ）

### 主要な属性
- タグID
- タグ名（例：「ハンバーガー」「カフェ」「丼」）
- 表示順
- 作成日時

### 備考
- チェーン店のカテゴリ分類に使用
- 管理画面でタグの追加・編集・削除が可能
- タグ名の統一により、検索やフィルタリングの精度向上

---

## Chains（チェーン店）

### 主要な属性
- チェーンID
- チェーン名
- タグID（配列、複数タグ対応）
- 公式サイトURL
- ロゴ画像URL
- 作成日時
- 更新日時

### 備考
- 初期リリースでは16チェーンを手動登録
- タグは複数設定可能（例：スタバ→「カフェ」「テイクアウト」「モーニング」）
- 管理画面から追加・編集可能

---

## Menus（メニュー）

### 主要な属性
- メニューID
- 所属チェーンID（外部キー）
- メニュー名（必須）
- 説明（任意）
- 価格（任意）
- 画像URL（任意）
- 画像タイプ（テンプレート / 公式）
- メニュータイプ（期間限定 / 通常）
- 販売期間（任意）
  - 開始日（任意）
  - 終了日（任意、未定の場合はnull）
- ステータス（販売中 / 販売終了 / 予定）
- 作成日時
- 更新日時

### 備考
- メニュー名以外は任意入力
- 「期間限定」の定義は管理者の判断
- 販売期間の終了日は未定がほとんど（手動更新）
- 画像は当面テンプレアイコンを使用
  - 月見系、グラコロ系、カレー系などカテゴリ別アイコン
  - 将来的にチェーン店と提携したら公式画像に切り替え
- 注意書き：「販売終了している可能性があります。店舗にご確認ください。」

### 将来的な改善案
- ユーザーからの「販売終了報告」機能
- 管理画面で販売終了を一括更新

---

## Users（ユーザー）

### 主要な属性
- ユーザーID（Firebase UID）
- 表示名（任意）
- メールアドレス（Googleログインの場合）
- プロフィール画像URL（任意）
- 認証方法（匿名 / Google）
- 作成日時
- 最終ログイン日時

### 備考
- 匿名認証から始めて、後でGoogleログインに移行（UID継続）
- Custom Claimsは持たない（一般ユーザー）
- Firestoreは`/users/{uid}`コレクションで管理

---

## Admins（管理者）

### 主要な属性
- 管理者ID（Firebase UID）
- 表示名
- メールアドレス
- 認証方法（メール＋パスワード）
- Custom Claims（`admin: true`）
- 作成日時
- 最終ログイン日時

### 備考
- Firebase Authenticationは共通だが、認証方法は「メール＋パスワード」
- Custom Claimsで`admin: true`を設定
- Firestoreは`/admins/{uid}`コレクションで管理（一般ユーザーと分離）
- Security Rulesで`isAdmin()`関数を使って権限チェック

---

## Reviews（レビュー）

### 主要な属性
- レビューID
- ユーザーID（外部キー）
- メニューID（外部キー）
- 食べた日
- コメント（任意）
- 作成日時
- 更新日時

### 備考
- 点数評価は行わない（複数回食べた記録が重要）
- 同じメニューを同じ日に複数回レビュー可能（熱狂的なファン対応）
- 重複チェックなし（実装がシンプル、柔軟性が高い）

### UI上の工夫
- マイページで「このメニューを5回食べてる！」と視覚的に表示
- 食べた回数でバッジ表示（🍔×5など）

---

## Favorites（お気に入り）

### 主要な属性
- お気に入りID
- ユーザーID（外部キー）
- チェーンID（外部キー）
- 登録日時

### 備考
- ユーザーごとにお気に入りチェーン店を管理
- お気に入り登録したチェーンの期間限定メニューを優先表示

---

## データの関連性

```
Tags (1) ─── (N) Chains ─── (N) Menus
                │              │
Users (1) ─── (N) Favorites    │
  │                            │
  └─── (N) Reviews ─────────── (1)

Admins (管理者、別コレクション)
```

---

## 未解決の問題

- スクレイピングで取得したデータの正規化方法
  - 各チェーン店ごとにHTMLの構造が異なるため、個別対応が必要
  - 別途詳細な設計が必要

---

# データ更新の方針

## 基本方針

- メニュー情報はスクレイピングによる自動更新が理想的だが、法的リスクを避けるため、手動運用でスタートする
  - ほとんどのチェーン店サイトは利用規約で「無断スクレイピング禁止」を明記している
  - 個人開発のサービスで初期リリースから許諾を得るのは現実的ではない

---

## データ取得方法

### Phase2（MVP）：完全手動運用
- **管理画面から手動登録**
  - 管理画面（React Admin）からメニュー情報を手入力
  - チェーン店の公式サイトを人が確認し、期間限定メニュー情報を登録
  - 画像はテンプレアイコンを使用

- **運用効率化の補助ツール**
  - 後述の「運用効率化の補助ツール」を活用し、情報収集を効率化
  - ただし、最終的な登録作業は全て人が行う

### Phase3以降（チェーン店提携後）
- **半自動化**
  - 提携内容に応じて最適な方法を採用
  - 公式API、データ提供、Webhook、スクレイピング許可など
  - 画像も公式素材に切り替え

---

## 運用効率化の補助ツール

完全手動運用だが、以下の**合法的な補助ツール**を活用することで運用負荷を軽減する

### 受信方法（共通）

GoogleアラートとRSSリーダーは、以下の方法で受信可能：

- **RSSリーダー**（Feedly、Inoreader等）
  - 複数のRSSフィードを一元管理
  - 既読管理が容易
- **Slack**（RSS連携機能で購読）
  - チームで情報共有する場合に便利
  - リアルタイム通知

### 1. Googleアラート（無料）

#### 概要
- Googleが提供する公式の監視サービス
- 指定キーワードの検索結果を定期的に通知

#### 設定方法
```
16チェーン分のアラートを設定
例：「マクドナルド 新メニュー OR 期間限定」

頻度：1日1回
配信先：RSSフィード（推奨）
```

#### メリット・デメリット
- ✅ 完全無料、利用規約的に問題なし
- ✅ ニュース記事も拾える
- ❌ 精度がイマイチ（関係ない記事も通知）
- ❌ 最大1日遅れ

### 2. RSSリーダー（無料）

#### 概要
- 信頼性の高いニュースサイトのRSSを購読
- RSS配信は「購読してください」という公開意思があるため、法的に問題なし

#### 推奨RSSソース
- ニュースサイト
  - ITmedia ビジネス
  - マイナビニュース（グルメ）
  - 食品産業新聞
- グルメサイト
  - ぐるなび みんなのごはん
  - 食べログ マガジン

#### 購読方法
```
上記の推奨RSSソースをRSSリーダーまたはSlackで購読
```

#### メリット・デメリット
- ✅ 完全無料、利用規約的に問題なし
- ✅ Googleアラートより精度が高い可能性
- ❌ RSS配信しているサイトが限られる
- ❌ 情報源の信頼性にバラつき

### 3. AI補助（事実情報の抽出）

#### 概要
- ニュース記事からメニュー名、価格、期間を抽出
- 事実情報（データ）には著作権がないため、抽出自体は合法

#### 使い方
```
1. RSSやGoogleアラートで気になる記事を発見
2. 記事をAI（ChatGPT、Claude等）に渡す
   「この記事からメニュー名、価格、期間を抽出して」
3. AIが抽出した情報をメモ
4. 公式サイトで事実確認
5. 正しければ管理画面から手動登録
```

#### 注意事項
- ⚠️ 記事の文章をそのまま転載しない（事実情報のみ抽出）
- ⚠️ 必ず公式サイトで確認（誤情報のリスク）
- ⚠️ RSSサイトの利用規約を確認
- ⚠️ 完全自動化はしない（人が確認するプロセスを挟む）

#### メリット・デメリット
- ✅ 入力作業が楽になる
- ✅ 事実情報の抽出は合法
- ❌ AIが誤る可能性（公式確認必須）
- ❌ 自動化するほど法的リスクが高まる

### 4. 公式SNS監視（Phase3以降）

#### 概要
- Twitter API、Instagram Graph API等で公式アカウントを監視
- 各プラットフォームのAPI利用規約を遵守する必要あり

#### 使い方
```
Twitter APIで公式アカウントの投稿を取得
新メニュー関連の投稿があればSlack通知
管理者が公式サイトで確認して登録
```

#### 注意事項
- ⚠️ Twitter API（X API）は有料化されている
- ⚠️ 各プラットフォームの利用規約を確認

### 5. 季節メニューのリマインダー

#### 概要
- 過去データから「月見バーガーは9月」と学習
- 時期が近づいたらSlackで通知

#### 使い方
```
Firestoreの過去データを分析
毎年同じ時期に出るメニューを検出
「そろそろ月見バーガーの時期です」とSlack通知
管理者が公式サイトで確認
```

#### メリット
- ✅ 完全にシステム内のデータのみ使用
- ✅ 法的リスクゼロ

### 6. 管理画面での入力補助

#### 概要
- コピペしやすいフォーム設計
- 過去の類似メニューから入力候補を表示
- URLを貼り付けるとブラウザで開くボタン

#### メリット
- ✅ 入力作業が楽になる
- ✅ 法的リスクゼロ

---

## 運用フローのイメージ

### Phase2（MVP）での日常運用
```
毎朝：
  Googleアラート（メール） → チェック
  RSSリーダー（Feedly等） → チェック
    ↓
  気になる記事を発見
    ↓
  AIで事実情報を抽出（メニュー名、価格、期間）
    ↓
  公式サイトで事実確認
    ↓
  正しければ管理画面から手動登録
```

### Phase3以降（チェーン店提携後）
```
提携チェーン：
  公式API / Webhook / データ提供
    ↓
  半自動で管理画面に反映（または完全自動）

未提携チェーン：
  Phase2と同じ手動運用を継続
```

---

## 注意事項

### 法的リスクの回避
- **スクレイピングは行わない**
- **利用規約を完全に遵守する**
- **著作権を侵害しない**
  - ニュース記事の文章をそのまま転載しない
  - 事実情報（メニュー名、価格、期間）のみ利用
  - 画像は公式素材を使わず、テンプレアイコンを使用
- **個人情報を取得しない**
- **完全自動化はしない**（人が確認するプロセスを必ず挟む）

### ユーザーへの注意書き
サービス上に以下の注意書きを表示：
「販売終了している可能性があります。詳細は店舗にご確認ください」

---

## まとめ

| 項目 | Phase2（MVP） | Phase3以降（チェーン店提携後） |
|------|-------------|------------------------------|
| データ取得 | 完全手動登録 | 半自動化（提携内容に応じて） |
| 情報収集補助 | Googleアラート、RSSリーダー、AI補助 | 同左 + 公式SNS監視 |
| 画像 | テンプレアイコン | 公式素材 |
| 法的リスク | ✅ ゼロ（利用規約完全遵守） | ✅ ゼロ（提携済み） |

**重要**：Phase2では法的リスクを完全に排除することを最優先とし、運用負荷は許容する

---

# 技術スタック

- Firebase
  - Auth / Firestore / Functions / Hosting / Scheduler
- Cloud Run
  - 将来的なAPI / BFF用
- Web
  - React
- 管理画面
  - React Admin
- モバイル
  - Expo + React Native / SwiftUI / Jetpack Compose
- CI/CD
  - GitHub Actions

---

# リポジトリ構成

| リポジトリ | 役割 | 備考 |
|-------------|------|------|
| `limimeshi-web` | 一般向けWebアプリ | Hosting:web |
| `limimeshi-admin` | 管理UI | Hosting:admin |
| `limimeshi-jobs` | 定期処理・差分検知 | Functions（onSchedule） |
| `limimeshi-docs` | 企画・設計・ADR・AI前提 | 公開リポジトリ |
| （将来）`limimeshi-api` | 共通API / BFF | Cloud Functions (HTTP) |
| （将来）`limimeshi-expo`, `limimeshi-ios`, `limimeshi-android` | 各モバイル実装 | 学習目的 |

---

# 認証・権限ルール

- フロント
  - 匿名認証 → Googleログイン（UID継続）
- 管理画面
  - メール＋パスワード、`customClaims.admin=true`
- Firestore Security Rules
  - `isAdmin()` / `isOwner()` を共通関数化
  - 一般ユーザーと管理者で明確に分岐
- 危険操作
  - Functions 経由

---

# 対象のチェーン店候補

- ハンバーガー
  - マクドナルド、モスバーガー、ケンタッキーフライドチキン、バーガーキング、ロッテリア、サブウェイ、フレッシュネスバーガー
- 弁当
  - ほっともっと、ほっかほっか亭、キッチンオリジン
- その他のファーストフード
  - 銀だこ
- 丼
  - 吉野家、すき家、松屋、なか卯、かつや、てんや、松のや
- うどん
  - 丸亀製麺、はなまるうどん
- 寿司
  - スシロー、はま寿司、くら寿司、かっぱ寿司
- 洋食
  - カレーハウス CoCo壱番屋、ハンバーグレストラン びっくりドンキー、洋麺屋五右衛門
- 中華
  - 日高屋、餃子の王将、大阪王将、幸楽苑、リンガーハット、福しん、ぎょうざの満洲
- ピザ
  - ドミノピザ、ピザハット、ピザーラ
- 居酒屋
  - 鳥貴族、やきとり大吉、串カツ田中
- カフェ
  - スターバックスコーヒー、ドトールコーヒーショップ、コメダ珈琲店、タリーズコーヒー、星乃珈琲店、サンマルクカフェ

## 初期リリースで対応するチェーン店候補

- マクドナルド
- モスバーガー
- ケンタッキーフライドチキン
- バーガーキング
- 吉野家
- すき家
- 松屋
- なか卯
- かつや
- 丸亀製麺
- カレーハウス CoCo壱番屋
- 日高屋
- 餃子の王将
- スターバックスコーヒー
- コメダ珈琲店
- サンマルクカフェ

---

# 収益モデル

- SSP広告を表示してアクセス数を増やす
- アクセス数が集まってきたら、新メニューの告知広告を出したいというチェーン店が現れるかもしれない

---

# 非機能要件

- 本セクションは [ISO/IEC 25010:2023（システム及びソフトウェア製品の品質モデル）](https://www.iso.org/standard/78176.html) に基づいて定義
- ただし、現時点で定義が難しい品質特性は後回し

---

## 1. 機能適合性（Functional Suitability）

### なぜ重要か
サービスが提供する機能が、ユーザーのニーズを満たしているかを保証する

### 測定指標
- 機能完全性：要求された機能がすべて実装されているか（メニュー一覧、お気に入り、レビュー、位置情報検索など）
- 機能正確性：機能が正しい結果を返すか（期間限定判定、検索結果、位置情報計算など）
- 機能適切性：機能がタスク達成に適しているか（期間限定メニュー探し、食べた記録の振り返りなど）

### 現時点での方針
- Phase2（MVP）では基本機能（メニュー一覧、お気に入り）と管理画面に集中
- レビュー機能と位置情報機能はPhase3以降で実装
- 最初期はメニュー登録の運用を安定させることを最優先

### 機能の優先順位

#### Phase2（MVP）で必須
1. メニュー一覧表示
   - 期間限定メニューの一覧表示
   - 通常メニューの表示（チェーン詳細ページ）
   - チェーン店別のフィルタリング
2. お気に入り登録
   - チェーン店のお気に入り登録・解除
   - お気に入り登録したチェーンのみの一覧表示
3. 管理画面（React Admin）
   - チェーン店管理（登録・編集・削除）
   - メニュー管理（登録・編集・削除）
   - タグ管理
4. 差分検知システム
   - 公式サイトの更新検知（1日1回）
   - Slack通知

#### Phase3以降
- レビュー機能（食べた回数記録、コメント）
- 位置情報検索
- ユーザーからの販売終了報告機能

### TBD
- 各機能の詳細仕様（Phase1で検討）

---

## 2. 性能効率性（Performance Efficiency）

### なぜ重要か
- ページ読み込みが遅いとユーザーが離脱するため、特にモバイルユーザーに対してページ読み込み速度を最適化する
- ユーザー数増加時のコスト爆発を防ぐため、リリース前に負荷テストを実施し、想定ユーザー数での動作とコストを事前検証する

### 測定指標
- 時間効率性：ページ読み込み時間、API応答時間
- 資源効率性：メモリ使用量、ネットワーク帯域
- 容量：同時接続数、データ量
- 負荷耐性：想定ユーザー数（DAU 1,000人、10,000人、100,000人）での動作検証、ピークタイムでのレスポンス時間

### 現時点での方針
- Firebaseの自動スケーリングに依存
- 画像はWebP形式で最適化
- Firestoreクエリの最適化
- リリース前に負荷テスト必須（Phase2で実施、後回し厳禁）
  - Artillery、k6、Firebase Emulatorを使った負荷テスト
  - 想定ユーザー数でのコスト試算
  - パフォーマンスボトルネックの特定と改善

### TBD
- 具体的な目標値（ページ読み込み時間3秒以内、API応答時間1秒以内など、Phase1で検討）
- 同時接続数の想定（Phase1で検討）
- データ量の見積もり（Phase1で検討）
- 負荷テストのシナリオ設計（Phase1で検討）

---

## 3. 互換性（Compatibility）

### なぜ重要か
多様なデバイス・ブラウザで動作することで、ユーザー層を広げられる

### 測定指標
- 共存性：他のシステムと共存できるか（ブラウザの拡張機能、他のWebアプリとの並行利用など）
- 相互運用性：他のシステムと情報交換できるか（外部API連携、構造化データ、SNSシェアなど）

### 現時点での方針
- レスポンシブデザイン：スマートフォン、タブレット、PC

### サポート範囲
- **ブラウザ**：Chrome、Safari（最新版）
- **OS**：iOS、Android（直近3世代程度）

### 方針
- モバイルファースト（スマートフォン優先）
- ブラウザの自動更新を前提
- サポート範囲外でも動くケースは多いが、動作保証はしない
- 問題が発生した場合は個別に対応するが、端末依存は深追いしない
- iOS/Androidアプリのリリース時に最低OSを決める

### TBD
- 外部サービス連携の仕様（Phase2以降で検討）

---

## 4. 使用性（Usability）

### なぜ重要か
使いやすいUIでないとユーザーが離脱するため、特に中高生やシニア層への配慮を含めた使いやすさを確保する

### 測定指標
- 認知性：初見でサービスを理解できるか（トップページで何ができるか一目で分かるなど）
- 習得性：操作方法を素早く習得できるか（お気に入り登録、レビュー投稿の分かりやすさなど）
- 運用性：日常的に使いやすいか（検索のしやすさ、情報の見つけやすさなど）
- ユーザーエラー防止性：誤操作を防げるか（削除前の確認、入力バリデーションなど）
- UI美観性：見た目が良いか（デザインの統一感、視認性など）
- アクセシビリティ：障害のある人も使えるか（スクリーンリーダー対応、キーボード操作など）

### 現時点での方針
- モバイルファースト
- セマンティックHTML
- キーボード操作対応
- カラーコントラスト確保（WCAG2.1 AA準拠）

### TBD
- UI/UXデザインの詳細（Phase1で検討）
- ユーザビリティテストの実施計画（Phase1で検討）
- アクセシビリティの具体的な実装方法（Phase1で検討）

---

## 5. 信頼性（Reliability）

### なぜ重要か
サービスが頻繁に落ちると、ユーザーの信頼を失う

### 測定指標
- 成熟性：障害の頻度（エラー発生率、クラッシュ率など）
- 可用性：稼働率（アクセス可能時間、ダウンタイムなど）
- 障害許容性：障害時の継続性（一部機能停止時の代替手段、グレースフルデグラデーションなど）
- 回復性：障害からの復旧時間（RTO、RPO、バックアップからの復元など）

### 現時点での方針
- 目標稼働率：99.9%（Firebaseの標準SLA）
- Firestoreの自動バックアップに依存
- エラーハンドリング：ユーザーにわかりやすいエラーメッセージ
- 重大なエラーはSlack通知

### TBD
- 障害時の対応手順（Phase1で検討）
- 復旧時間目標（RTO）、復旧ポイント目標（RPO）の設定（Phase1で検討）
- バックアップ戦略の詳細（Phase1で検討）

---

## 6. セキュリティ（Security）

### なぜ重要か
個人情報（メールアドレス、レビュー内容）を扱うため、セキュリティは最重要

### 測定指標
- 機密性：認可されていない者がデータにアクセスできないか（Security Rules、認証・認可など）
- 完全性：データが不正に改ざんされていないか（Security Rules、トランザクション処理など）
- 否認防止性：行為を否認できないか（ログ記録、監査証跡など）
- 責任追跡性：行為を追跡できるか（ユーザーアクション履歴、管理者操作ログなど）
- 真正性：主体やリソースの真正性を証明できるか（Firebase Authentication、トークン検証など）
- プライバシー保護：個人情報が保護されているか（匿名化、最小限収集、プライバシーポリシーなど）（2023版で強化）

### 現時点での方針
- 認証・認可：Firebase Authentication、Custom Claimsによる管理者権限管理、Security Rulesによるデータアクセス制御
- データ保護：HTTPS通信、Firestore Security Rulesで個人情報を保護、Firebase Authによるパスワード管理（ハッシュ化）
- アクセス制御：一般ユーザーは自分のデータのみ読み書き可能、管理者は全データの読み書き可能、メニュー・チェーン情報は全ユーザーが読み取り可能
- プライバシー保護：匿名認証をデフォルトとし必要に応じてGoogleログインに移行、個人を特定できる情報の収集を最小限に

### TBD
- プライバシーポリシーの策定（Phase1で検討、Phase2リリース前必須）
- 個人情報保護法への対応（Phase1で検討、Phase2リリース前必須）
- セキュリティ監査の実施（Phase2以降で検討）
- 脆弱性診断の実施（Phase2以降で検討）

---

## 7. 保守性（Maintainability）

### なぜ重要か
- 長期的にサービスを運用するため、コードの保守性が重要
- テストとCI/CDを後回しにすると、手動テスト・手動デプロイが常態化し、品質低下とリリース遅延を招くため、最優先で整備する

### 測定指標
- モジュール性：変更の影響範囲が限定的か（コンポーネント分割、疎結合など）
- 再利用性：コンポーネントを他で再利用できるか（共通UI部品、ユーティリティ関数など）
- 解析性：問題の原因を特定しやすいか（ログ、エラートレース、型定義など）
- 修正性：バグ修正が容易か（コードの可読性、テストカバレッジなど）
- 試験性：テストが容易か（単体テスト、E2Eテスト、Storybookなど）
- 自動化度：CI/CDパイプラインの整備状況、テスト自動実行率、デプロイ自動化率

### 現時点での方針
- TypeScriptで型安全性を確保
- ESLint、Prettierでコードスタイル統一
- コメントは必要最小限（コードで意図を表現）
- コンポーネント単位でのモジュール化
- Storybookでコンポーネントカタログを作成（UI開発・テスト・ドキュメント化）
- CI/CDパイプラインの最優先構築（Phase2の初期段階で実施、後回し厳禁）
  - GitHub Actionsでテスト自動実行（PR作成時、mainブランチマージ時）
  - デプロイ自動化（Firebase Hosting、Cloud Functions）
  - リント・型チェック・テストの全自動化
- テストコードの並行作成（実装と同時に作成、後回し厳禁）
  - 単体テスト：Jest、Vitest
  - E2Eテスト：Playwright、Cypress
  - テストカバレッジ目標：70%以上（Phase1で目標設定）

### TBD
- テスト戦略の詳細（Phase1で検討）
  - テストカバレッジ目標の具体値
  - テスト対象の優先順位
  - テストデータの管理方法
- コードレビュープロセス（Phase1で検討）
- ドキュメント整備の方針（Phase1で検討）
- CI/CDパイプラインの詳細設計（Phase1で検討）

---

## 8. 移植性（Portability）

### なぜ重要か
将来的に他のクラウドへの移行や、モバイルアプリ展開を見据える

### 測定指標
- 適応性：異なる環境に適応できるか（開発・ステージング・本番環境、モバイルアプリ化など）
- 設置性：異なる環境にインストールできるか（他のクラウドへのデプロイ、オンプレミス展開など）
- 置換性：他のシステムと置き換えられるか（Firebaseから他のBaaSへの移行、データエクスポートなど）

### 現時点での方針
- Firebaseに依存した設計（初期フェーズでは許容）
- データエクスポート機能は未実装

### TBD
- 他のクラウドへの移行可能性（Phase2以降で検討）
- データエクスポート機能の実装（Phase2以降で検討）
- モバイルアプリ展開の技術選定（Phase3以降で検討）

---

## 9. AIシステム品質（AI System Quality）

### なぜ重要か
- ユーザーに合わせたパーソナライズされたコンテンツ表示が標準になりつつある
- LLMなどの外部AIシステムから参照・リンクされることも重要な流入経路となる

### 測定指標
- 説明可能性（Explainability）：AIの判断理由を説明できるか
- 公平性（Fairness）：特定のユーザーに偏った結果を出していないか
- 透明性（Transparency）：AIの動作をユーザーが理解できるか
- 外部AI連携性：LLMなどの外部AIシステムから正しく参照されるか（独自追加）

### 現時点での方針
- 初期フェーズではAI機能は未実装
- 構造化データ（Schema.org等）を活用して外部AIからの参照を容易に

### TBD
- パーソナライズ機能の実装時期（Phase3以降で検討）
- レコメンデーションアルゴリズムの選定（Phase3以降で検討）
- 外部AI連携の具体的な実装方法（Phase1で検討）
- AIの透明性・説明可能性の確保方法（Phase3以降で検討）

---

## 10. 環境サステナビリティ（Environmental Sustainability）

### なぜ重要か
環境負荷を最小限にすることが社会的責任として重要性を増しているため、サステナビリティを考慮する

### 測定指標
- エネルギー効率：サーバー・ネットワークの消費電力（Cloud Functions実行時間、データ転送量など）
- リソース使用量：ストレージ、メモリ、CPU使用率（Firestore容量、画像サイズ、関数メモリなど）
- CO2排出量：データセンターからの排出量（Googleのカーボンレポート、間接的）

### 現時点での方針
- Firebaseの環境配慮に依存（Googleのカーボンニュートラル目標）
- 画像最適化によるデータ転送量削減

### TBD
- サステナビリティの具体的な目標設定（Phase2以降で検討）
- エネルギー効率の測定・モニタリング方法（Phase2以降で検討）
- カーボンオフセットの取り組み（Phase2以降で検討）

---

# 開発フェーズ・マイルストーン

- 本プロジェクトは、企画・設計・実装・運用の4つのフェーズに分けて段階的に進める

---

## Phase0：企画の妥当性検証

### 目的
サービスの全体像を多角的に整理し、ビジネスモデルとプロジェクトの方向性を明確化する

### 主要タスク
1. `first-idea.md`の拡充
   - ターゲットユーザー・ペルソナ
   - データモデル（概要）
   - スクレイピング・データ更新の方針
   - 非機能要件
   - 開発フェーズ・マイルストーン
   - リスクと対策
   - モニタリング・分析
2. リーンキャンバス作成（`lean-canvas.md`）
3. インセプションデッキ作成（`inception-deck.md`）
4. 整合性チェック（3つのドキュメント間の矛盾解消）

### 成果物
- `first-idea.md`（完成版）
- `lean-canvas.md`
- `inception-deck.md`

### 完了条件
- 企画ドキュメントがすべて揃い、矛盾がない状態

---

## Phase1：設計・仕様策定

### 目的
実装に必要な詳細設計を行い、技術選定の根拠を明確化する

### 主要タスク
1. ディレクトリ構成の整備（`specs/`, `adr/`, `api/`, `data-model/`）
2. GitHub Spec Kitで機能設計
   - メニュー一覧機能
   - お気に入り登録機能
   - レビュー機能
   - 位置情報機能（Phase2実装予定）
   - スクレイピング機能（差分検知のみ）
3. ADRで技術選定記録
   - なぜFirebaseを選んだか
   - モノレポ vs マルチリポ
   - React Adminを選んだ理由
   - スクレイピング手法の選定
4. データモデル詳細設計
   - Firestoreコレクション設計
   - セキュリティルール設計
   - インデックス設計

### 成果物
- `specs/` 配下の機能設計書
- `adr/` 配下の技術選定記録
- `data-model/` 配下の詳細設計書

### 完了条件
- 実装に必要な設計書がすべて揃い、技術選定の根拠が明確

---

## Phase2：MVP実装

### 目的
最小限の機能で動作するプロトタイプを実装し、ユーザーフィードバックを得る

### 主要タスク
1. リポジトリセットアップ
   - `limimeshi-web`
   - `limimeshi-admin`
   - `limimeshi-jobs`
2. CI/CDパイプライン構築（最優先、後回し厳禁）
   - GitHub Actionsでテスト自動実行
   - デプロイ自動化（Firebase Hosting、Cloud Functions）
   - リント・型チェック・テストの全自動化
   - mainブランチへのマージ前にテスト必須化
3. 初期データ投入
   - 16チェーン店を手動登録
   - 各チェーンの期間限定メニューを手動登録
4. 基本機能実装（テストコードと並行作成）
   - メニュー一覧表示
   - お気に入り登録
   - レビュー機能
   - 差分検知システム（Slack通知）
   - 各機能の単体テスト・E2Eテストを実装と同時に作成
5. 管理画面実装（React Admin）
   - チェーン店管理
   - メニュー管理
   - ユーザー管理
6. 負荷テスト・コスト検証（リリース前必須、後回し厳禁）
   - 負荷テストツール（Artillery、k6、Firebase Emulator）のセットアップ
   - 想定ユーザー数（DAU 1,000人、10,000人、100,000人）でのシナリオテスト
   - コスト試算（最悪ケースも含む）
   - パフォーマンスボトルネックの特定と改善
   - Firestore読み取り・書き込み回数の最適化確認
   - Cloud Functions実行回数・実行時間の確認
7. テスト・品質保証
   - 単体テストカバレッジ確認（目標70%以上）
   - E2Eテスト実施
   - ユーザビリティテスト
   - セキュリティテスト（Security Rulesの検証）

### 成果物
- 動作するWebアプリケーション（ベータ版）
- 管理画面
- 差分検知システム

### 完了条件
- 16チェーン店の期間限定メニューが一覧できる
- お気に入り登録とレビュー機能が動作する
- 管理画面から手動でメニュー登録ができる
- CI/CDパイプラインが構築され、テスト・デプロイが自動化されている
- 単体テスト・E2Eテストが実装され、カバレッジ目標を達成している
- 負荷テストを実施し、想定ユーザー数でのコスト試算が完了している

---

## Phase3：ベータリリース・フィードバック収集

### 目的
限定ユーザーにサービスを公開し、実際の利用状況からフィードバックを得る

### 主要タスク
1. ベータリリース
   - Firebase Hostingにデプロイ
   - 限定公開（友人・知人のみ）
2. フィードバック収集
   - ユーザーインタビュー
   - アンケート実施
   - アクセス解析（Google Analytics）
3. 改善実施
   - UI/UX改善
   - パフォーマンス改善
   - バグ修正

### 成果物
- ベータ版サービス
- フィードバックレポート
- 改善実施記録

### 完了条件
- 一定数のユーザーからフィードバックを得られた
- 致命的なバグがない状態

---

## Phase4：本番リリース・運用

### 目的
サービスを一般公開し、継続的に運用・改善する

### 主要タスク
1. 本番リリース
   - ドメイン取得（limimeshi.com）
   - 本番環境へのデプロイ
   - プライバシーポリシー・利用規約の公開
2. マーケティング
   - SNSでの告知（Twitter, Instagram）
   - プレスリリース
3. モニタリング・分析
   - アクセス解析
   - エラーログ監視
   - ユーザー行動分析
4. 継続的改善
   - ユーザーフィードバックへの対応
   - 新機能追加（位置情報機能など）
   - チェーン店との提携交渉

### 成果物
- 本番稼働中のサービス
- 運用ドキュメント
- モニタリングダッシュボード

### 完了条件
- サービスが安定稼働している
- ユーザー数が増加傾向にある

---

## Phase5以降：スケールアップ・機能拡張（将来構想）

### 想定される拡張
1. 位置情報機能の実装（Phase2で設計、Phase5で実装）
2. モバイルアプリ展開（Expo / SwiftUI / Jetpack Compose）
3. チェーン店との提携（公式API連携、画像提供）
4. パーソナライズ機能（レコメンデーション）
5. 外部AI連携（Schema.org、構造化データ）

---

# リスクと対策

プロジェクトを進める上で想定されるリスクと、その対策を整理する

---

## 1. 法的リスク

### リスク内容
- スクレイピングによる著作権侵害や利用規約違反
- チェーン店からの情報削除要請やクレーム
- 個人情報保護法違反

### 影響度
高（サービス停止の可能性）

### 対策
- 初期フェーズではスクレイピングを行わず、完全手動登録でスタート
- 差分検知はハッシュ値のみ保存し、HTMLは保存しない
- robots.txtと利用規約を遵守
- プライバシーポリシー・利用規約を作成し、個人情報の取り扱いを明確化
- 匿名認証をデフォルトとし、個人情報の収集を最小限に

### 現状
Phase0で法的リスクを最小化した設計を採用済み

---

## 2. データ鮮度の問題

### リスク内容
- 手動登録のため、期間限定メニューの終了情報が遅れる
- ユーザーが「既に終了したメニュー」を見て店舗に行ってしまう
- サービスの信頼性が低下する

### 影響度
中（ユーザー体験の悪化）

### 対策
- サービス上に「販売終了している可能性があります。店舗にご確認ください。」という注意書きを表示
- 差分検知システムで公式サイトの更新を自動検知し、管理者に通知
- ユーザーからの「販売終了報告」機能の実装を検討（Phase2以降）
- チェーン店との提携により、公式情報の定期提供を目指す

### 現状
Phase0で注意書き表示の方針を決定、差分検知システムの設計済み

---

## 3. 初期ユーザー獲得の難しさ

### リスク内容
- 競合サービス（食べログ、各チェーン公式アプリ）が既に存在
- ニッチなサービスのため、認知度を上げるのが難しい
- ユーザーが集まらず、サービスが継続できない

### 影響度
高（サービスの存続に関わる）

### 対策
- ペルソナを明確化し、ターゲットユーザーに刺さる価値提案を行う
- SNS（Twitter, Instagram）での告知、ハッシュタグ「#リミメシ」の活用
- 友人・知人からのベータテストでフィードバックを得る
- SEO対策（期間限定メニュー名での検索流入を狙う）
- 外部AI（LLM）からの参照を容易にする構造化データの活用

### 現状
Phase0でペルソナ定義済み、Phase3でベータテスト予定

---

## 4. 技術的負債の蓄積

### リスク内容
- 初期フェーズでは手動登録に依存するが、スケール時に対応できない
- Firebaseに依存した設計のため、他のクラウドへの移行が困難
- コードの保守性が低下し、機能追加やバグ修正が困難になる

### 影響度
中（長期的な運用に影響）

### 対策
- TypeScript、ESLint、Prettierでコード品質を担保
- コンポーネント単位でのモジュール化、疎結合な設計
- Storybookでコンポーネントカタログを作成し、UI開発・テスト・ドキュメント化
- ADR（Architecture Decision Records）で技術選定の根拠を記録
- Phase1で詳細設計を行い、スケール時の課題を事前に洗い出す

### 現状
Phase0で保守性の方針を決定、Phase1でADR作成予定

---

## 5. チェーン店との提携交渉の難航

### リスク内容
- チェーン店からの公式情報提供やAPI連携が得られない
- 画像の利用許可が下りず、テンプレアイコンのまま
- スクレイピング許可が得られず、手動登録が継続

### 影響度
中（サービスの成長に影響）

### 対策
- 初期フェーズではチェーン店との提携を前提とせず、手動登録でスタート
- サービスの認知度が上がり、アクセス数が集まってから提携交渉を開始
- 提携交渉時には、チェーン店側のメリット（新メニューの告知、ユーザーの流入）を明確に提示
- 提携が得られない場合でも、テンプレアイコンと手動登録で運用可能な設計

### 現状
Phase0で提携前提としない設計を採用済み

---

## 6. 運用コストの増加・コスト爆発

### リスク内容
- 手動登録の運用負荷が高く、管理者の工数がかかる
- Firebase利用料が増加し、収益モデルが確立していない段階でコストが膨らむ
- 広告収益が想定通り得られず、赤字運営が継続
- 意図しない要因での爆発的アクセス（バズ、メディア掲載など）によるコスト急増
- 実装不備による非効率な処理（無限ループ、重複クエリなど）でコスト増加
- 悪意あるユーザーによる攻撃（DoS、大量リクエスト、Cloud Functions の意図的な連続実行など）

### 影響度
高（個人開発では致命的、サービス停止の可能性）

### 対策

#### 運用負荷の削減
- 初期フェーズでは16チェーンに絞り、運用負荷を最小化
- 運用工数削減のため、差分検知システムで効率化

#### コスト管理・予算上限設定
- Firebase予算アラートの設定（月額予算の閾値で通知）
- Blazeプランの上限設定（可能な範囲で）
- 定期的なコスト監視（Firebase コンソール、Google Cloud Billing）
- 初期は無料枠を最大限活用し、有料プラン移行は慎重に判断

#### コスト爆発の防止策（技術的対策）
- Firestore
  - クエリの最適化（インデックス活用、不要な読み取りを避ける）
  - キャッシュの活用（クライアント側、CDN）
  - ページネーション実装（一度に大量データを取得しない）
- Cloud Functions
  - タイムアウト設定（デフォルト60秒→短縮）
  - メモリ制限（必要最小限に設定）
  - 実行回数制限（レート リミット、リトライ回数制限）
  - 冪等性の確保（重複実行されても問題ない設計）
- Cloud Scheduler
  - 実行頻度を必要最小限に（1日1回など）
  - エラー時のリトライ回数を制限
- Hosting / Storage
  - 画像はWebP形式で最適化
  - CDNキャッシュの活用
  - 不要なファイル転送を避ける

#### 悪意あるユーザーへの対策
- レート リミット
  - Cloud Functions で呼び出し回数を制限
  - Firebase App Check の導入検討（Phase1以降）
  - 異常なアクセスパターンの検知と遮断
- Security Rules の厳格化
  - 最小権限の原則（必要最小限の読み書き権限のみ付与）
  - 書き込み回数制限（1ユーザーあたりの1日のレビュー投稿数など）
- 認証必須化
  - 匿名認証でも認証を必須とし、完全な未認証アクセスは拒否
  - 不正なアクセスをログに記録

#### 収益化
- SSP広告を導入し、アクセス数に応じた収益化を目指す
- ユーザー数が一定数集まるまでは、最小限のコストで運営

### 現状
- Phase0で初期対応チェーンを16に限定、収益モデルを検討済み
- コスト爆発対策は Phase1 の詳細設計で具体化予定

---

## 7. セキュリティインシデント

### リスク内容
- 不正アクセスによるユーザー情報の漏洩
- Security Rulesの設定ミスによるデータ改ざん
- 管理者アカウントの乗っ取り

### 影響度
高（サービスの信頼性に致命的影響）

### 対策
- Firebase Authentication、Custom Claims、Security Rulesでアクセス制御
- Security Rulesは厳格に設定し、最小権限の原則に従う
- 管理者アカウントは2要素認証を有効化
- 定期的なセキュリティ監査と脆弱性診断（Phase2以降）
- プライバシーポリシーを作成し、個人情報の取り扱いを明確化

### 現状
Phase0でセキュリティ方針を決定、Phase2以降で監査実施予定

---

## 8. テスト・CI/CD不足による品質低下とコスト爆発

### リスク内容
- テストを後回しにした結果
  - 手動テストが常態化し、リリースのたびに工数がかかる
  - バグが本番環境で発見され、ユーザーに影響が出る
  - リグレッション（既存機能の劣化）が発生しやすくなる
- CI/CDを後回しにした結果
  - 手動デプロイが常態化し、人為的ミスが発生する
  - デプロイ作業に時間がかかり、リリース頻度が下がる
  - テスト実行が属人化し、チーム拡大時に破綻する
- 負荷テスト不足による予期せぬコスト爆発
  - ユーザー数増加時にパフォーマンス問題が発覚
  - 非効率なクエリ・処理でFirebaseコストが想定の数倍に
  - サービス停止や緊急対応で機会損失
  - 過去の事例：ユーザー増加時に赤字化した経験あり

### 影響度
高（個人開発では致命的、サービスの継続性に関わる）

### 対策

#### テスト整備（後回し厳禁）
- 実装と同時にテストコードを作成
- 単体テスト：Jest、Vitest
- E2Eテスト：Playwright、Cypress
- テストカバレッジ目標：70%以上
- コードレビュー時にテストの有無を必須確認

#### CI/CD整備（最優先）
- Phase2の最初期にGitHub Actionsでパイプライン構築
- PR作成時にテスト自動実行
- mainブランチマージ時にデプロイ自動化
- テスト失敗時はマージ不可
- リント・型チェック・テストの全自動化

#### 負荷テスト実施（リリース前必須）
- Artillery、k6、Firebase Emulatorを使った負荷テスト
- 想定ユーザー数（DAU 1,000人、10,000人、100,000人）でのシナリオテスト
- コスト試算を事前に実施
  - Firestore読み取り・書き込み回数の計測
  - Cloud Functions実行回数・実行時間の計測
  - 最悪ケース（ピークタイム、バズ時）のコスト見積もり
- パフォーマンスボトルネックの特定と改善
- クエリ最適化、キャッシュ活用、ページネーション実装

### 現状
- Phase0でテスト・CI/CD・負荷テストの重要性を認識
- Phase2で最優先タスクとして実施予定
- 過去の失敗を教訓に、後回し厳禁を明記

---

# モニタリング・分析

サービスの健全性、ユーザー行動、ビジネス指標を継続的に監視し、データドリブンな意思決定を行う

---

## 1. アクセス解析

### 目的
ユーザーの行動を理解し、サービス改善に活かす

### 測定指標
- ページビュー（PV）
- ユニークユーザー数（UU）
- セッション数
- 直帰率
- 平均セッション時間
- ページ別滞在時間
- 流入元（検索、SNS、直接アクセスなど）
- デバイス比率（スマートフォン、タブレット、PC）
- ブラウザ・OS比率

### ツール
- **Google Analytics4（GA4）**
  - 無料で導入可能
  - ユーザー行動の詳細な分析
  - カスタムイベントの設定
- **Firebase Analytics**
  - Firebaseとの統合が容易
  - リアルタイムデータの確認

### 実装時期
Phase2（MVP実装時）

---

## 2. ユーザー行動分析

### 目的
ユーザーがサービスをどのように使っているかを理解し、UX改善に活かす

### 測定指標
- **ファネル分析**
  - トップページ → メニュー一覧 → メニュー詳細 → レビュー投稿
  - 各ステップでの離脱率
- **機能別利用状況**
  - お気に入り登録数
  - レビュー投稿数
  - 位置情報検索の利用率
  - チェーン別の閲覧数
- **ユーザー属性**
  - 新規ユーザー vs リピートユーザー
  - 匿名ユーザー vs Googleログインユーザー
  - ユーザーあたりの平均レビュー数

### ツール
- **Google Analytics4**（ファネル分析、コホート分析）
- **Firebase Analytics**（ユーザープロパティ、カスタムイベント）
- **Firestore集計クエリ**（お気に入り数、レビュー数など）

### 実装時期
Phase3（ベータリリース時）

---

## 3. エラー監視・ログ管理

### 目的
エラーやバグを早期発見し、迅速に対応する

### 測定指標
- **エラー発生率**
  - Cloud Functions のエラー率
  - Firestore の失敗率
  - クライアント側のJavaScriptエラー
- **エラーの種類**
  - 認証エラー
  - データ取得エラー
  - 書き込みエラー
  - タイムアウト
- **重大度別分類**
  - Critical（サービス停止）
  - Error（機能不全）
  - Warning（パフォーマンス低下）
  - Info（情報）

### ツール
- **Firebase Console**
  - Cloud Functions のログ確認
  - エラー率の監視
- **Sentry（導入検討）**
  - JavaScriptエラーのリアルタイム監視
  - エラーのスタックトレース
  - Slack通知連携
- **Slack通知**
  - 重大なエラーを Slack に自動通知
  - Cloud Functions から直接送信

### 実装時期
- Phase2（MVP実装時）：Firebase Console、Slack通知
- Phase3（ベータリリース時）：Sentry導入検討

---

## 4. パフォーマンス監視

### 目的
サービスのレスポンス速度を監視し、ユーザー体験を最適化する

### 測定指標
- **Core Web Vitals**
  - LCP（Largest Contentful Paint）：最大コンテンツの描画時間
  - FID（First Input Delay）：初回入力遅延
  - CLS（Cumulative Layout Shift）：累積レイアウトシフト
- **ページ読み込み時間**
  - トップページ
  - メニュー一覧ページ
  - メニュー詳細ページ
- **API応答時間**
  - Firestore クエリの応答時間
  - Cloud Functions の実行時間
- **ネットワーク転送量**
  - データ転送量（KB/MB）
  - リクエスト数

### ツール
- **Google PageSpeed Insights**
  - Core Web Vitals の測定
  - 改善提案の取得
- **Firebase Performance Monitoring**
  - リアルタイムのパフォーマンス監視
  - ネットワークリクエストのトレース
- **Chrome DevTools**
  - ローカルでのパフォーマンス確認
  - Lighthouse によるスコア計測

### 実装時期
Phase2（MVP実装時）

---

## 5. コスト監視

### 目的
Firebase利用料を監視し、コスト爆発を防ぐ

### 測定指標
- **Firebase使用量**
  - Firestore 読み取り・書き込み回数
  - Cloud Functions 実行回数・実行時間
  - Hosting 転送量
  - Storage 容量
- **月額コスト**
  - 各サービスごとのコスト内訳
  - 前月比の変動率
- **予算アラート**
  - 設定した閾値（例：月額5,000円）を超えた場合に通知

### ツール
- **Firebase Console**
  - 使用量の確認
  - コストの内訳表示
- **Google Cloud Billing**
  - 詳細なコスト分析
  - 予算アラートの設定
  - レポートのエクスポート
- **Slack通知**
  - コストアラートを Slack に通知

### 実装時期
Phase2（MVP実装時）

---

## 6. ビジネス指標（KPI）

### 目的
サービスの成長を測定し、ビジネスとしての成功を評価する

### 測定指標
- **ユーザー成長**
  - 累計ユーザー数
  - 月間アクティブユーザー数（MAU）
  - 週間アクティブユーザー数（WAU）
  - 日間アクティブユーザー数（DAU）
- **エンゲージメント**
  - レビュー投稿数（累計・月間）
  - お気に入り登録数（累計・月間）
  - ユーザーあたりの平均レビュー数
  - リピート率（7日以内、30日以内）
- **収益**
  - 広告収益（月間・累計）
  - RPM（Revenue Per Mille：1000インプレッションあたりの収益）
  - ARPU（Average Revenue Per User：ユーザーあたりの平均収益）
- **コンテンツ**
  - 登録チェーン数
  - 登録メニュー数（期間限定・通常）
  - チェーン別のメニュー登録率

### ツール
- **Firestore集計クエリ**
  - ユーザー数、レビュー数、お気に入り数の集計
- **Google Analytics4**
  - MAU、DAU、リピート率の測定
- **SSP管理画面**
  - 広告収益、RPMの確認
- **スプレッドシート**
  - KPIダッシュボードの作成
  - 週次・月次レポートの作成

### 実装時期
Phase3（ベータリリース時）

---

## 7. セキュリティ監視

### 目的
不正アクセスや攻撃を検知し、迅速に対応する

### 測定指標
- **異常なアクセスパターン**
  - 短時間での大量リクエスト
  - 同一IPからの連続アクセス
  - 未認証ユーザーからの大量アクセス
- **認証失敗率**
  - ログイン失敗回数
  - 認証エラーの頻度
- **Security Rules 違反**
  - 不正なデータアクセスの試行
  - 権限エラーの発生

### ツール
- **Firebase Console**
  - 認証ログの確認
  - Security Rules のテスト
- **Cloud Functions ログ**
  - 異常なアクセスパターンの検知
  - レート リミット超過のログ
- **Slack通知**
  - セキュリティアラートを Slack に通知

### 実装時期
Phase2（MVP実装時）

---

## モニタリング体制のまとめ

| 項目 | ツール | 実装時期 | 通知先 |
|------|--------|----------|--------|
| アクセス解析 | Google Analytics4 | Phase2 | - |
| ユーザー行動分析 | GA4, Firebase Analytics | Phase3 | - |
| エラー監視 | Firebase Console, Sentry | Phase2 | Slack |
| パフォーマンス監視 | Firebase Performance Monitoring | Phase2 | - |
| コスト監視 | Google Cloud Billing | Phase2 | Slack |
| KPI | Firestore, GA4, スプレッドシート | Phase3 | - |
| セキュリティ監視 | Firebase Console, Cloud Functions | Phase2 | Slack |

---
